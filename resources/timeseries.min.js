(function(l){var j="";function f(){this.version="0.0.26";this.length=0;this.create=function(u,t){if(!t){t={}}if(typeof t.logging!=="boolean"){t.logging=this.log.logging}if(typeof t.logtime!=="boolean"){t.logtime=this.log.logtime}t.index=this.length;this.length++;return new c(u,t)};this.load={resources:{files:{},callbacks:[]},data:{files:{},callbacks:[]}};this.callback="";this.scroll={};this.log=new Logger({id:"TimeSeries",logging:(location.search.indexOf("logging=true")>0),logtime:(location.search.indexOf("logtime=true")>0)});var r=document.getElementsByTagName("script");var s=r[r.length-1].src.split("?")[0];var q=s.lastIndexOf("/");j=(q>=0)?s.substr(0,q+1):"";if(console){console.log("%ctimeseries.js v"+this.version+"%c","font-weight:bold;font-size:1.25em;","")}this.loadFromDataFile=function(v,t,u){this.log.message("loadFromDataFile",v,t,u);t.file=v;if(!this.load.data.files[v]){this.log.time("loadFromDataFile "+v);this.load.data.files[v]={loaded:false,callbacks:[]};if(!this.load.counter){this.load.counter=0}if(!this.load.data.files[v].name){this.load.data.files[v].id="file-"+(this.load.counter++)}this.load.data.files[v].callbacks.push({fn:u,attr:t});this.log.message("loading data",v);t["this"].updateMessage("main"+this.load.data.files[v].id,"Loading "+t.dataset.name+"...");S().ajax(v,{dataType:"text","this":this,master:t["this"],file:v,id:this.load.data.files[v].id,success:function(z,x){z=z.replace(/[\n\r]$/,"");x.master.updateMessage("main"+x.id,"");var w=this.load.data.files[x.file].callbacks;for(var y=0;y<w.length;y++){this.load.data.files[w[y].attr.file].data=z;this.load.data.files[w[y].attr.file].loaded=true;if(typeof w[y].fn==="function"){w[y].fn.call(w[y].attr["this"],this.load.data.files[w[y].attr.file].data,w[y].attr)}}this.log.message("loaded from data file "+x.file);this.log.time("loadFromDataFile "+x.file)},error:function(z,x){var w=this.load.data.files[x.file].callbacks;for(var y=0;y<w.length;y++){w[y].attr["this"].error("Failed to load",x.file,z)}}})}else{if(!this.load.data.files[v].loaded){this.load.data.files[v].callbacks.push({fn:u,attr:t})}else{if(typeof u==="function"){u.call(t["this"],this.load.data.files[v].data,t)}}}};S(document).on("scroll",{me:this},function(v){var u=v.data.me,t=u.scroll;if(t){for(var w in t){if(typeof t[w].callback==="function"){v.data=(typeof t[w].data==="object")?t[w].data:{};t[w].callback.call((v.data["this"]||u),v)}}}});return this}TimeSeries=new f();function c(r,q){if(!q){q={}}this.attr=q;if(typeof r==="object"){this.json=r;this.vega=JSON.parse(JSON.stringify(r))}else{if(typeof r==="string"){this.file=r}}this.log=new Logger({logging:(q.logging||false),logtime:(q.logtime||false),id:"TS"});if(typeof q.showaswego==="undefined"){q.showaswego=false}this.log.message("TS",r);this.progress={datasets:{old:"",used:""},update:{todo:0,done:0}};this.options={xaxis:{title:"Time",log:false,fit:true},yaxis:{title:"y-axis",log:false},grid:{hoverable:true,clickable:true,color:"#888888"},labels:{color:"#000000"},fit:false,tooltip:{theme:"aas-theme"},showaswego:q.showaswego};this.xformats={auto:{title:"Auto",types:{absolute:true,relative:true},scale:1,formatLabel:function(w,t){var u=(t.input=="seconds"||t.input=="")?w:e(w,t.input,"seconds");return{str:t.niceDate(u,t.spacing)}}},locale:{title:"Locale",scale:1,types:{absolute:true},formatLabel:function(u,t){return{str:(new Date(e(u,t.input,"unix"))).toLocaleString()}}},iso:{title:"ISO8601",scale:1,types:{absolute:true},formatLabel:function(w,t){var x={str:"?"};var u=e(w,t.input,t.output);if(t.spacing.name=="days"){u=u.replace(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/,function(v,y){return y})}x.str=u.replace(/\.0+Z/,"Z");return x}},jd:{title:"Julian date",scale:86400,types:{absolute:true},formatLabel:function(u,t){return{str:e(u,t.input,t.output)+""}}},mjd:{title:"Modified Julian date",scale:86400,types:{absolute:true},formatLabel:function(u,t){return{str:e(u,t.input,t.output)+""}}},tjd:{title:"Truncated Julian date",scale:86400,types:{absolute:true},formatLabel:function(u,t){return{str:e(u,t.input,t.output)+""}}},relative:{title:"Relative date",types:{relative:true},scale:1,convert:function(u,t){if(t=="hours"){return Num(u).times(3600).toValue()}return u},formatLabel:function(u,B){var x,w,G,H,A,C,z,y,t,F,E,D;x=typeof u;if(u==0){return{str:"0"}}if(x=="string"||x=="number"){u=Num(u)}if(u==null){return{str:""}}w=(u.gte(0))?1:-1;G=u.abs();H=u.abs();if(B){D=Math.abs(B.ticks[B.ticks.length-1].value)}else{D=H}if(typeof D.toValue==="function"){D=D.toValue()}F=["y","d","h","m","s"];A={y:86400*365.25,d:86400,h:3600,m:60,s:1};C="";E={};for(z=0;z<F.length;z++){y=F[z];t=A[y];E[y]=Number(H.div(t).round(0,0));H=H.minus(E[y]*t)}if(H.gt(0)){E.f=H.toString();E.f=E.f.substr(E.f.indexOf("."))}C="";if(E.y>0){C=E.y+"y"}if(E.d>0){C+=(C?" ":"")+E.d+"d"}if(D>A.h){C+=(C?" ":"")+g(E.h,2)+":"}if(D>A.m){C+=""+g(E.m,2)}if(E.s>0||E.f){C+=(D>A.m||D>A.h||G.gt(A.d)?":":"")+(D>A.s?g(E.s,2):E.s)}if(E.f){C+=E.f}return{str:(w<0?"-":"")+C}}},seconds:{title:"Seconds",types:{relative:true},convert:function(u,t){if(t=="hours"){return Num(u).times(3600).toValue()}else{if(t=="days"){return Num(u).times(86400).toValue()}else{if(t=="years"){return Num(u).times(31557600).toValue()}}}return u}},hours:{title:"Hours",types:{relative:true},convert:function(u,t){if(t=="seconds"||t=="relative"){return Num(u).div(3600).toValue()}else{if(t=="days"){return Num(u).times(24).toValue()}else{if(t=="years"){return Num(u).times(8766).toValue()}}}return u}},days:{title:"Days",types:{relative:true},convert:function(u,t){if(t=="seconds"||t=="relative"){return Num(u).div(86400).toValue()}else{if(t=="hours"){return Num(u).div(24).toValue()}else{if(t=="years"){return Num(u).times(365.25).toValue()}}}return u}},years:{title:"Years",types:{relative:true},convert:function(u,t){if(t=="seconds"||t=="relative"){return Num(u).div(31557600).toValue()}else{if(t=="hours"){return Num(u).div(8766).toValue()}else{if(t=="days"){return Num(u).div(365.25).toValue()}}}return u}},unity:{title:"Phase (unity)",types:{phase:true},convert:function(u,t){if(t=="degrees"){return Num(u).div(360).toValue()}else{if(t=="radians"){return Num(u).div(2).toValue()}}return u},formatLabel:function(u,t){return{str:u.toString()}}},degrees:{title:"Phase (degrees)",types:{phase:true},convert:function(u,t){if(t=="unity"){u=Num(u).times(360).toValue()}else{if(t=="radians"){u=Num(u).times(180).toValue()}}return u},spacing:function(t){if(t>300){return 90}if(t>200){return 60}if(t>100){return 30}else{return 0}},formatLabel:function(u,t){return{str:u.toString()+"°"}}},radians:{title:"Phase (radians)",types:{phase:true},convert:function(u,t){if(t=="unity"){return Num(u).times(2).toValue()}else{if(t=="degrees"){return Num(u).div(180).toValue()}}return u},formatLabel:function(u,t){return{str:u.toString()+"π"}}}};this.datasets=[];this.directory="";for(var s in q){if(q[s]){if(s=="directory"){this[s]=q[s]}if(s=="fit"||s=="tooltip"){this.options[s]=q[s]}}}if(this.json){this.processJSON(r)}return this}c.prototype.processJSON=function(s){this.json=h(s);this.vega=h(s);this.log.message("processJSON",s,this.json);if(s.width){this.options.width=s.width}if(s.height){this.options.height=s.height}if(s.padding){this.options.padding=s.padding}if(s.axes){for(var q=0;q<s.axes.length;q++){var r="";if(s.axes[q].orient=="bottom"){r="xaxis"}if(s.axes[q].orient=="left"){r="yaxis"}if(r){this.options[r]=s.axes[q]}}}return this};c.prototype.initialize=function(t,u){if(this.initializing){return this}this.log.message("initialize",t);this.initializing=true;if(typeof u==="function"){this.callback=u}if(!t){this.log.error(t,u)}var r=S(t);if(r.length==0){this.log.error("No DOM element to attach to",t);return this}this.el=t;if(t.getAttribute("loading")=="lazy"){if(!n(t)){TimeSeries.scroll[this.attr.index]={data:{me:this,el:t,callback:u,i:this.attr.index},callback:function(v){if(n(v.data.el)){v.data.me.initializing=false;delete this.scroll[v.data.i];v.data.me.initialize(v.data.el,v.data.callback)}}};return this}}var s=r.attr("vega-src");if(s){this.file=s}if(!this.file){this.file=""}if(typeof this.file!=="string"){return this}if(typeof this.initializedValues==="undefined"){this.initializedValues={w:t.clientWidth,h:t.clientHeight}}if(this.file){var q=this.file.lastIndexOf("/");this.directory=(q>=0)?this.file.substr(0,q+1):"";S().ajax(this.file,{dataType:"json","this":this,cache:true,success:function(w,v){if(!w){this.error("JSON is invalid",v.url)}else{this.processJSON(w);this.postProcess()}},error:function(w,v){this.error("Unable to load configuration",v.url,w)}})}else{this.postProcess();return this}return this};c.prototype.postProcess=function(){this.log.message("postProcess",this);this.log.time("postProcess");var y,r,v,q,u,z,w,A;if(this.json){var t,x;if(!this.json._extend){this.json._extend={}}if(!this.json._views){this.json._views=[]}z=0;for(u=0;u<this.json.marks.length;u++){if(!this.json.marks[u].name){this.json.marks[u].name="fake-id-"+z;this.log.warning("No name for mark "+u+" so naming it "+this.json.marks[u].name)}z++}if(this.json._extend.marks){for(u=0;u<this.json._extend.marks.length;u++){if(!this.json._extend.marks[u].name){this.json._extend.marks[u].name="fake-id-"+z;this.log.warning("No name for mark "+u+" so naming it "+this.json._extend.marks[u].name)}z++}}t=false;for(u=0;u<this.json._views.length;u++){if(this.json._views[u].name=="default"){t=true;x=h(this.json._views[u])}}if(!t){x={name:"default",title:(this.json.title||"Default"),description:(this.json.description||"The initial view"),markers:[],}}if(!x.scales){x.scales=h(this.json.scales)}if(!x.axes){x.axes=h(this.json.axes)}if(!x._extend){x._extend=h(this.json._extend)}if(!t){for(u=0;u<this.json.marks.length;u++){x.markers.push({name:this.json.marks[u].name,include:true,visible:true})}this.json._views.unshift(x)}this._view=x}if(this.options.fit){this.options.width=this.initializedValues.w;this.options.height=this.initializedValues.h}this.options.logging=this.log.logging;this.options.logtime=this.log.logtime;this.options.scrollWheelZoom=true;if(this.json.scales){for(y=0;y<this.json.axes.length;y++){for(u=0;u<this.json.scales.length;u++){if(this.json.axes[y].scale==this.json.scales[u].name){r=(this.json.axes[y].orient=="left"?"yaxis":"xaxis");this.options[r].type=(this.json.scales[u].type||(r=="xaxis"?"utc":"linear"));this.options[r].padding=(this.json.scales[u].padding||0);if(this.json.scales[u].range){this.options[r].range=this.json.scales[u].range}if(this.json.scales[u].domain){this.options[r].domain=h(this.json.scales[u].domain);for(v=0;v<this.options[r].domain.length;v++){if(this.options[r].domain[v].signal){this.options[r].domain[v]=d(this.options[r].domain[v].signal)}}}}}if(this._view._extend.scales){for(A=0;A<this._view._extend.scales.length;A++){if(this.json.axes[y].scale==this._view._extend.scales[A].name){r=(this.json.axes[y].orient=="left"?"yaxis":"xaxis");this.options[r].highprecision=(this._view._extend.scales[A].highprecision||false)}}}}}this.graph=new Graph(this.el,this.options);q=S(this.el);w='<div class="loader"><div class="spinner">';for(u=1;u<6;u++){w+='<div class="rect'+u+' seasonal"></div>'}w+="</div></div>";q.addClass("timeseries").append(w);this.makeMenu();if(this.json&&this.json.data){this.loadDatasets(this.json.data)}this.log.time("postProcess");return this};c.prototype.updateMessage=function(u,s,q,t){var r=S(this.el).find(".loader");if(!u){r.html("");return this}if(!this.message){this.message={}}u=this.el.getAttribute("id")+"-"+u;if(!this.message[u]){r.append('<div id="'+u+'"><div class="loader-message"></div></div>');r=r.find("#"+u);this.message[u]={el:r,message:r.find(".loader-message")}}if(s||(typeof q==="number"&&q<=100)){if(this.message[u].message.length>0){this.message[u].message[0].innerHTML=s}if(typeof q==="number"&&q<=100){if(!this.message[u].progress){this.message[u].el.append('<div class="progressbar"><div class="progress-inner"></div></div>');this.message[u].progress=this.message[u].el.find(".progress-inner")}this.message[u].progress.css({width:q+"%"});if(t){this.message[u].progress.css({background:t})}}}else{this.message[u].el.remove()}return this};c.prototype.makeMenu=function(){var s,v,r,u,q,t;s=S(this.el);v=s.attr("id");if(s.find(".menuholder").length==0){t=[{key:"views",title:"Views",html:'<ol class="views"></ol>'},{key:"layers",title:"Marker layers",html:'<ol class="layers"></ol>',on:true},{key:"config",title:"Options",html:'<div class="row"><button class="fullscreen icon" title="Toggle fullscreen">'+k("fit")+'</button><button class="autozoom">Reset view</button></div><div class="row"><button class="fontup">A&plus;</button><button class="fontreset">A</button><button class="fontdn">A&minus;</button></div>'},{key:"save",title:"Save",html:'<div class="row"><button class="savepng" data="white">Save as PNG</button><button class="savepng">Save as transparent PNG</button><button class="savevega">Save as JSON (VEGA-compatible)</button><button class="editvega">Open selected view in VEGA</button></div>'},{key:"about",title:"About",html:'<p>Figure produced with the <a href="https://aperiosoftware.github.io/timeseries.js/">AAS timeseries.js</a> package version '+TimeSeries.version+".</p><p>You can zoom into the figure using a scroll wheel. Use the scroll wheel over one axis to zoom along that axis only. Pressing the <em>Alt</em> key and then clicking and dragging with your mouse will zoom to your selected region.</p>"}];u="";q="";for(r=0;r<t.length;r++){u+='<li class="submenu-'+t[r].key+'"><button '+(t[r].on?'class="on" ':"")+'data="submenu-'+t[r].key+'" title="'+t[r].title+'">'+k(t[r].key,"white")+"</button></li>";q+=(t[r].html?'<div class="menu-panel submenu-'+t[r].key+(t[r].on?" on":"")+'">'+t[r].html+"</div>":"")}u+="<li></li>";s.prepend('<div class="menuholder"><input type="checkbox" id="'+v+'_hamburger" class="hamburger"><label for="'+v+'_hamburger" class="hamburger">'+k("menu","white")+'<span class="nv">Toggle menu (if not visible)</span></label><menu class="timeseries-actions-wrapper"><ul class="submenu">'+u+"</ul>"+q+"</menu></div>");for(r=0;r<t.length;r++){if(t[r].on){s.find("submenu-"+t[r].key).addClass("on")}}s.find(".menuholder").on("mouseover",function(){S(".graph-tooltip").css({display:"none"})});s.find("#"+v+"_hamburger").on("click",{me:this},function(x){var w=(this[0].checked?0:-1);this.parent().find("menu button, menu a").attr("tabIndex",w)});s.find("button.fullscreen").on("click",{g:this.graph},function(w){w.data.g.toggleFullScreen()});s.find("button.autozoom").on("click",{g:this.graph},function(w){w.data.g.zoom()});s.find("button.fontup").on("click",{g:this.graph},function(w){w.data.g.scaleFont(+1)});s.find("button.fontdn").on("click",{g:this.graph},function(w){w.data.g.scaleFont(-1)});s.find("button.fontreset").on("click",{g:this.graph},function(w){w.data.g.scaleFont(0)});s.find("button.savevega").on("click",{me:this},function(w){w.data.me.save("vega")});s.find("button.editvega").on("click",{me:this},function(w){w.data.me.save("vegaeditor")});s.find("button.savepng").on("click",{me:this},function(w){w.data.me.save("png",{background:S(w.currentTarget).attr("data")})});s.find(".submenu button").on("click",{el:s},function(y){y.data.el.find(".on").removeClass("on");var x=S(y.currentTarget);var w=x.attr("data");x.addClass("on");y.data.el.find(".menu-panel."+w).addClass("on")})}return this};c.prototype.loadDatasets=function(v){this.log.message("loadDatasets",v);this.log.time("loadDatasets");if(!v){return this}this.updateMessage("main","Loading data...");if(v.length==0){S(this.el).find(".loader").html("&#9888; No data defined");return this}this.datasets={};var w,u,t,s,r,q;w=v.length;u="";t=[];this.progress.datasets={todo:w,done:0};s=function(A,x){var y;var z="json";if(x&&x.dataset&&x.dataset.format&&x.dataset.format.type=="csv"){z="csv"}if(z=="csv"){y=m(A,x.dataset.format.parse)}else{if(z=="json"){y=A[0]}}this.datasets[x.dataset.name]={json:y,parse:x.dataset.format.parse};this.datasets[x.dataset.name][z]=A;this.progress.datasets.done++;this.log.message("loaded dataset",x.dataset.name);if(this.progress.datasets.done==this.progress.datasets.todo){this.processDatasets()}};for(r=0;r<w;r++){if(v[r].url){t.push(this.directory+v[r].url)}}this.log.message("files",t);for(r=0;r<w;r++){if(v[r].values){s.call(this,v[r].values,{dataset:v[r],files:t})}}for(q=0;q<t.length;q++){TimeSeries.loadFromDataFile(t[q],{"this":this,dataset:v[q],files:t},s)}this.updateMessage("main","");this.log.time("loadDatasets");return this};c.prototype.updateLayerMenu=function(){var E,D,z,t,r,B,y,C,x,F,v,G,L,s,I,K,A,H,u,J,q;r=this.graph.canvas.container.find(".layers");r.find("li").remove();s={};I={};for(E in this.graph.marks){if(this.graph.marks[E]){z=S(this.el).attr("id")+"_"+E;L=this.graph.marks[E].desc;if(this.graph.marks[E].include){if(typeof s[L]==="undefined"){s[L]=[]}s[L].push(E)}}}D=0;for(L in s){if(s[L]){if(typeof s[L]!=="undefined"){z=S(this.el).attr("id")+"_"+D;G=this.graph.marks[s[L][0]];r.append('<li><input type="checkbox" id="'+z+'" data="'+L+'" /><label for="'+z+'"><span class="key" style="background-color:'+G.format.fill+";"+(G.type=="area"&&G.format.fillOpacity?"opacity:"+G.format.fillOpacity+";":"")+'">?</span>'+L+"</label></li>");B=r.find("#"+z);y=B.parent();C=y.find(".key");B.on("change",{me:this,k:s[L]},function(O){var N,M,w;N=O.data.me.graph;for(M=0;M<O.data.k.length;M++){w=O.data.k[M];N.marks[w].show=!N.marks[w].show}N.redraw({update:true,cancelable:false});if(O.currentTarget.checked){this.parent().removeClass("inactive")}else{this.parent().addClass("inactive")}}).on("focus",{layers:r},function(w){w.data.layers.find("li").removeClass("on").removeClass("selected");this.parent().addClass("on")});r.on("mouseover",{layers:r},function(w){w.data.layers.find(".selected").removeClass("selected")});I[s[L][0]]=B.parent();v=false;for(E=0;E<s[L].length;E++){if(["symbol","rect","line","rule","text","area"].indexOf(G.type)>=0){v=true}}if(v&&C.length==1){t=window.getComputedStyle(C[0]);x=parseInt(t.width);F=parseInt(t.height);C.html('<canvas style="width:'+x+"px;height:"+F+'px;"></canvas>')}if(y.find("canvas").length==1){H=y.find("canvas")[0];x=parseInt(y.find("canvas").css("width"));F=parseInt(y.find("canvas").css("height"));A=H.getContext("2d");K=window.devicePixelRatio;H.width=x*K;H.height=F*K;A.scale(K,K);A.clearRect(0,0,x,F);A.fillStyle="#ffffff";A.rect(0,0,x,F);A.fill();for(E=0;E<s[L].length;E++){G=this.graph.marks[s[L][E]];if(G.include){C.css({"background-color":"none"});this.graph.setCanvasStyles(A,G.mark[0]);if(G.type=="symbol"){this.graph.drawShape(h(G.mark[0]),{ctx:A,x:x/2,y:F/2})}else{if(G.type=="rect"){if(G.mark[0].props.x1&&G.mark[0].props.x2&&G.mark[0].props.y1&&G.mark[0].props.y2){this.graph.drawRect(h(G.mark[0]),{ctx:A,x1:0,y1:0,x2:x,y2:F})}else{this.graph.drawRect(h(G.mark[0]),{ctx:A,x1:x/2,y1:0,x2:x/2,y2:F})}}else{if(G.type=="area"){this.graph.drawRect(h(G.mark[0]),{ctx:A,x1:0,y1:0,x2:x,y2:F})}else{if(G.type=="line"){A.beginPath();A.moveTo(0,F/2);A.lineTo(x,F/2);A.lineWidth=(G.encode.enter.strokeWidth.value||0.8);A.stroke()}else{if(G.type=="rule"){A.beginPath();A.lineWidth=(G.encode.enter.strokeWidth.value||1);if(!G.data[0].x2){G.data[0].x2=h(G.data[0].x)}if(!G.data[0].y2){G.data[0].y2=h(G.data[0].y)}if(G.data[0].y.value==G.data[0].y2.value){A.moveTo(0,F/2+0.5);A.lineTo(x,F/2+0.5)}else{if(G.data[0].x.value==G.data[0].x2.value){A.moveTo(x/2+0.5,0);A.lineTo(x/2+0.5,F)}else{A.moveTo(0,0);A.lineTo(x,F)}}A.stroke()}else{if(G.type=="text"){this.graph.drawTextLabel("T",x/2,F/2,{ctx:A,format:{align:"center",baseline:"middle"}})}}}}}}}}}q=false;J=false;for(E=0;E<s[L].length;E++){if(this.graph.marks[s[L][E]].include){q=true}if(this.graph.marks[s[L][E]].show){J=true}}u=r.find("#"+z).parent();u.css({display:(q?"block":"none")});if(J){u.removeClass("inactive");r.find("#"+z)[0].checked=true}else{u.addClass("inactive");r.find("#"+z)[0].checked=false}D++}}}this.graph.on("hoverpoint",{lookup:I,layers:r},function(M){M.data.layers.find("li").removeClass("selected");if(M.matches.length==0){return}for(var w=0;w<M.matches.length;w++){if(M.data.lookup[M.matches[w].series]){M.data.lookup[M.matches[w].series].addClass("selected")}}});return this};c.prototype.getViews=function(){var q,s,r;q=[];r=this.json._views;for(s=0;s<r.length;s++){q.push({title:(r[s].title||""),name:(r[s].name||""),description:(r[s].description||"")})}return q};c.prototype.setView=function(w,y){var x,v,B,C,z,u,r,G,E,D,t,F,q,A;v=this.json;if(typeof w!=="number"){A=JSON.stringify(w);for(u=0;u<v._views.length;u++){if(JSON.stringify(v._views[u])==A){w=u;continue}}if(typeof w!=="number"){this.log.error("Invalid view number provided: "+w);return this}}if(typeof w!=="number"){this.log.error("Invalid view index provided: "+w);return this}if(w>=v._views.length){this.log.error("The maximum index is "+(v._views.length-1)+"");return this}for(u=0;u<v._views.length;u++){v._views[u].active=(w==u)}B=h(v._views[w]);r={};for(C=0;C<v.axes.length;C++){if(B.scales){for(G=0;G<B.scales.length;G++){if(v.axes[C].scale==B.scales[G].name){t=(v.axes[C].orient=="left"?"yaxis":"xaxis");if(typeof r[t]!=="object"){r[t]={}}r[t].type=(t=="xaxis"?"utc":"linear");r[t].padding=0;if(B.scales[G]){if(typeof B.scales[G].type!=="undefined"){r[t].type=B.scales[G].type}if(typeof B.scales[G].padding!=="undefined"){r[t].padding=B.scales[G].padding}}if(B.scales[G].range||v._views[0].scales[G].range){r[t].range=h(B.scales[G].range||v._views[0].scales[G].range)}if(v._views[0].scales[G].domain||B.scales[G].domain){r[t].domain=h(B.scales[G].domain||v._views[0].scales[G].domain);for(z=0;z<r[t].domain.length;z++){if(r[t].domain[z].signal){r[t].domain[z]=d(r[t].domain[z].signal)}}}}}}if(B.axes){t=(v.axes[C].orient=="left"?"yaxis":"xaxis");r[t].title=(typeof B.axes[C].title!=="undefined"?B.axes[C].title:"")}}this._view=B;x=this.graph;x.setOptions(r);if(B.markers){for(u in x.marks){if(x.marks[u]){F=-1;x.marks[u].include=false;for(G=0;G<B.markers.length;G++){if(x.marks[u].name==B.markers[G].name){F=G;x.marks[u].include=true;x.marks[u].show=B.markers[G].visible}}}}}else{this.log.warning("No markers provided for view."+(B.marks?' You may have accidentally used "marks" as the key.':""))}this.updateLayerMenu();this.updateOptionsMenu();q=x.canvas.container.find(".views");E=q.find("li");for(u=0;u<E.length;u++){D=S(E[u]);if(w==u){D.addClass("selected").find("input").attr("checked","checked")}else{D.removeClass("selected").find("input").attr("checked","")}}x.updateData(y);return this};c.prototype.updateViewMenu=function(){var s,r,t,w,q,v,u;u="abcdefghijklmnopqrstuvwxyz";t=this.graph.canvas.container.find(".views");q=this.graph.canvas.container.find(".submenu-views");if(this.json._views.length<2){t.css({display:"none"});q.css({display:"none"});return this}else{t.css({display:""});q.css({display:""})}v=0;for(s=0;s<this.json._views.length;s++){if(this.json._views[s].active){v=this.json._views[s].active}}this.json._views[v].active=true;for(s=0;s<this.json._views.length;s++){w=S(this.el).attr("id")+"-view-"+s;if(t.find("#"+w).length==0){t.append("<li "+(this.json._views[s].active?' class="selected"':"")+'><input type="radio"'+(this.json._views[s].active?' checked="checked"':"")+' id="'+w+'" name="'+S(this.el).attr("id")+'-view" data="'+s+'" /><label for="'+w+'" title="'+this.json._views[s].description+'"><span style="font-family:monospace;">'+u.substr(s,1).toUpperCase()+".</span> "+this.json._views[s].title+"</label></li>");r=t.find("#"+w);r.on("change",{me:this,id:w,i:s,el:t},function(x){x.data.me.setView(x.data.i)}).on("focus",{el:t},function(x){x.data.el.find("li").removeClass("on");this.parent().addClass("on")})}}return this};c.prototype.updateOptionsMenu=function(){var r=S(this.el);var q=r.attr("id");if(r.find("#"+q+"_axisformat").length>0){r.find("#"+q+"_axisformat").parent().remove()}if(this._view._extend&&this._view._extend.scales){var w,u,t,A,z,v,y,x;for(A=0;A<this._view._extend.scales.length;A++){if(this._view._extend.scales[A].name=="xscale"){x=this._view._extend.scales[A].input;u="absolute";if(this.xformats[x].types.phase){u="phase"}if(this.xformats[x].types.relative){u="relative"}if(!this.xformats[x]&&!this.xformats[u]){this.log.error('Input format "'+x+'" is not valid.');return this}if(u=="phase"){w=(this._view._extend.scales[A].output||"unity");z="Phase format"}else{w=(this._view._extend.scales[A].output||"auto");z="Date format"}v='<div class="row"><label for="'+q+'_axisformat">'+z+': </label><select id="'+q+'_axisformat">';y=false;for(t in this.xformats){if(this.xformats[t]&&this.xformats[t].types[u]){v+='<option value="'+t+'"'+(t==w?' selected="selected"':"")+">"+this.xformats[t].title+"</option>";if(w&&this.xformats[w]&&t==w){this.setAxisFormat("x",w)}if(t==w){y=true}}}if(!y){this.log.error(w+" is not an available format",this.xformats,u)}v+="</select></div>";r.find(".menu-panel.submenu-config").append(v);r.find("#"+q+"_axisformat").on("change",{me:this},function(s){s.data.me.setAxisFormat("x",this[0].value,false)})}}}return this};c.prototype.setAxisFormat=function(u,r,v){var q="";if(this._view&&this._view._extend.scales){for(var t=0;t<this._view._extend.scales.length;t++){if(this._view._extend.scales[t].name=="xscale"){q=this._view._extend.scales[t].input}}}if(this.graph){if(this.xformats[r]){this.graph[u].units=q;this.graph.setAxisFormat(u,r,this.xformats);this.graph.defineAxis(u,this.graph[u].min,this.graph[u].max).redraw(v)}else{if(!this.xformats[q]){this.log.error("Input format "+q+" is not a known format")}if(!this.xformats[r]){this.log.error("Output format "+r+" is not a known format")}}}return this};c.prototype.processDatasets=function(){this.log.message("processDatasets",this.attr.showaswego,this.graph.marks);this.log.time("processDatasets");var t,x,w,r,u,q,s,v;if(!this.progress.marks){this.progress.marks={todo:0,done:0,mark:{}}}s=[this.json.marks];if(this.json._extend.marks){s.push(this.json._extend.marks)}for(r=0,v=0;r<s.length;r++){for(t=0;t<s[r].length;t++){if(!s[r][t].name){this.log.error("No name for "+s[r][t].title+" ("+t+")")}else{this.progress.marks.mark[s[r][t].name]={done:-1,todo:0}}v++}}this.progress.datasets.old=this.progress.datasets.used;for(x in this.datasets){if(this.datasets[x]&&!this.datasets[x].data){this.datasets[x].data=this.datasets[x].json}}this.graph.addDatasets(this.datasets);this.progress.marks.todo=this.json.marks.length+(this.json._extend.marks?this.json._extend.marks.length:0);u=function(y){this.progress.marks.done++;this.progress.marks.mark[y.name].done=y.i;this.progress.marks.mark[y.name].todo=y.total;this.log.message("Processed "+y.name,this.progress.marks.mark[y.name]);this.updateMessage(y.name,"");if(this.attr.showaswego){this.graph.updateData()}if(this.progress.marks.done==this.progress.marks.todo){this.finalize()}};q=function(z){this.progress.marks.mark[z.mark.name].done=z.i;this.progress.marks.mark[z.mark.name].todo=z.total;var y="";if(z.mark.encode&&z.mark.encode.update){if(z.mark.encode.update.fill){y=z.mark.encode.update.fill.value}if(!y&&z.mark.encode.update.stroke){y=z.mark.encode.update.stroke.value}}this.updateMessage(z.mark.name,"Processing "+(z.mark.description||z.mark.name),100*z.i/z.total,y);return this};this.updateMessage("main","");for(r=0;r<this.json.marks.length;r++){w=h(this.json.marks[r]);if(this.progress.marks.mark[w.name].done<=0){this.progress.marks.mark[w.name].done=0;a(this,r,w,{success:u,progress:q})}}if(this.json._extend.marks){for(r=0;r<this.json._extend.marks.length;r++){w=this.json._extend.marks[r];w.include=false;a(this,r+this.json.marks.length+r,h(w),{success:u,progress:q})}}for(r in this.graph.marks){if(this.graph.marks[r]){for(t=0;t<this._view.markers.length;t++){if(this.graph.marks[r].name==this._view.markers[t].name){if(!this._view.markers[t].visible){this.graph.marks[r].show=false}}}}}if(this.progress.datasets.used!=this.progress.datasets.old&&this.attr.showaswego){this.graph.updateData()}this.log.time("processDatasets");return this};c.prototype.finalize=function(){this.log.message("finalize",this.attr.showaswego,this.graph.marks);this.updateMessage("main","");function q(r){this.graph.canvas.container.find(".loader").remove();this.updateLayerMenu();this.updateViewMenu();this.updateOptionsMenu();if(typeof this.callback==="function"){this.callback.call(this)}this.log.info("Finished processing "+this.el.getAttribute("id"))}if(this.attr.showaswego==false){this.graph.updateData({callback:q,self:this})}else{q(this)}return this};c.prototype.save=function(A,y){if(typeof Blob!=="function"){return this}var w,x,F,B,q,u,r;q={type:"text/text",file:(this.file?this.file.replace(/.*\//g,""):"timeseries.json")};if(!y){y={}}function z(I){var s=new Blob([I],{type:q.type});function G(J){document.body.removeChild(J.target)}var H=document.createElement("a");H.download=q.file;H.innerHTML="Download File";if(window.webkitURL!=null){H.href=window.webkitURL.createObjectURL(s)}else{H.href=window.URL.createObjectURL(s);H.onclick=G;H.style.display="none";document.body.appendChild(H)}H.click()}if(A=="vega"||A=="vegaeditor"){r=h(this.vega);for(w=0;w<r.data.length;w++){delete r.data[w].url;u="json";if(this.datasets[r.data[w].name].csv){u="csv"}r.data[w].values=this.datasets[r.data[w].name][u]}if(A=="vegaeditor"){B=this._view;var C=[];var v={};var E,t;for(t=0;t<B.markers.length;t++){E=false;for(F=0;F<this.json.marks.length;F++){if(!v[B.markers[t].name]&&this.json.marks[F].name==B.markers[t].name){C.push(h(this.json.marks[F]));v[B.markers[t].name]=true}}if(!v[B.markers[t].name]&&this.json._extend&&this.json._extend.marks){for(F=0;F<this.json._extend.marks.length;F++){if(!v[B.markers[t].name]&&this.json._extend.marks[F].name==B.markers[t].name){C.push(h(this.json._extend.marks[F]));v[B.markers[t].name]=true}}}}r.marks=C;if(B.scales){r.scales=B.scales}if(B.axes){r.axes=B.axes}if(B.title){r.title=B.title}delete r._extend;delete r._views}x=JSON.stringify(r)}if(A=="vega"){q.type="text/json";q.file=(this.file?this.file.replace(/.*\//g,""):(y.file||"timeseries.json"));z(x)}if(A=="vegaeditor"){var D=window.open("https://vega.github.io/editor/#/","VEGA","");setTimeout(function(){D.postMessage({mode:"vega",spec:x,config:{axisY:{minExtent:30}},renderer:"svg"},"https://vega.github.io")},1000)}if(A=="png"){if(y&&y.background){this.graph.background=y.background;this.graph.clear().drawAxes().resetDataStyles().drawData(false)}q.type="image/png";q.file=(y.file||"timeseries.png");this.graph.canvas.c.toBlob(z,q.type);if(y){this.graph.background="";this.graph.clear().drawAxes().resetDataStyles().drawData(false)}}return this};c.prototype.error=function(s,q,r){this.log.error(s,q,r);if(S(this.el).find(".loader").length==0){S(this.el).html('<div class="loader"><div class="spinner"></div></div>').css({position:"relative",width:"100%",height:"200px"})}if(S(this.el).find(".spinner").length>0){S(this.el).find(".loader").html("&#9888; "+s);this.remove()}S(this.el).find(".loader").append("<br />"+q+"");return this};c.prototype.remove=function(){S(this.el).find(".menuholder").remove();S(this.el).find(".canvasholder").remove();return{}};function a(t,r,x,q){var w="";var s=true;if(!q){q={}}q["this"]=t;if(x.from&&x.from.data){if(typeof t.datasets[x.from.data]==="undefined"){t.log.error("Data source "+x.from.data+" doesn't seem to exist.");s=false}w=x.from.data;if(t.datasets[w]){t.progress.datasets.used+=w}}if((!w||t.datasets[w]||!s)&&!t.graph.marks[r]){var v=x.description||"Markers "+(r+1);var u={title:w,id:w,name:(x.name||""),desc:v,type:x.type,interactive:(typeof x.interactive==="boolean"?x.interactive:false),css:{"background-color":"#000000"},include:(typeof x.include==="boolean"?x.include:true)};if(x.type=="symbol"){u.symbol={show:true}}else{if(x.type=="rect"){u.rect={show:true}}else{if(x.type=="line"){u.lines={show:true}}else{if(x.type=="rule"){u.rule={show:true}}else{if(x.type=="area"){u.area={show:true}}else{if(x.type=="text"){u.text={show:true}}}}}}}if(t.datasets[w]){u.data=h(t.datasets[w].json);u.original=h(t.datasets[w].json);u.parse=t.datasets[w].parse}else{if(w&&!t.datasets[w]){t.log.error("No dataset for "+x.name)}u.data=[{props:{x:0,y:0,x2:0,y2:0}}];u.original={};u.parse={}}if(u){if(x.encode&&x.encode.hover){u.hoverable=true}u.encode=x.encode;if(x.encode.update||x.encode.hover){u.interactive=true}if(x.encode.enter){u.enter=function(z,A,y){return i(this,z,A,y)}}if(x.encode.update){u.update=function(z,A,y){return i(this,z,A,y)}}if(x.encode.hover){u.hover=function(z,A,y){return i(this,z,A,y)}}u.clip=(x.clip||false);t.graph.addMarks(u,r,x,q);if(t.datasets[w]){t.datasets[w].added=true}}else{t.log.message("No dataset built for "+w,x)}}return t}function i(E,B,q,u){var D,y,w,r,F,A,z,s;var t={};var v={};var C={size:"props",shape:"props",fill:"props",fillOpacity:"props",stroke:"props",strokeOpacity:"props",strokeWidth:"props",strokeCap:"props",strokeDash:"props",width:"props",height:"props",tooltip:"props",font:"props",fontSize:"props",fontWeight:"props",fontStyle:"props",baseline:"props",align:"props",dx:"props",angle:"props",limit:"props"};if(!B){return E.log.warning("updateProps fail",B,q)}if(typeof u==="number"){A=u;z=u+1}else{A=0;z=B.length-1}for(r in q){if(q[r]){v[r]=JSON.stringify(q[r]);if(q[r].signal){if(!t[r]){t[r]=JSON.stringify(q[r].signal)}}}}for(s=A;s<=z;s++){for(r in q){if(q[r]&&B[s]){if(C[r]&&C[r]=="props"){if(typeof q[r].value!=="undefined"){if(B[s].props.symbol){B[s].props.symbol[r]=q[r].value}if(B[s].props.format){B[s].props.format[r]=q[r].value}}}else{if(typeof B[s].data[r]==="undefined"){B[s].data[r]=(v[r]?JSON.parse(v[r]):h(q[r]))}if(q[r].field){if(typeof q[r].field==="string"){if(typeof B[s].data[q[r].field]!=="undefined"){B[s].data[r]=B[s].data[q[r].field]}else{E.log.error('The field "'+q[r].field+'" ('+r+"-axis) seems to be missing.",h(B[s]),q)}}else{if(typeof q[r].field==="object"){B[s].data[r]=(v[r]?JSON.parse(v[r]):h(q[r]))}}}if(typeof q[r].value!=="undefined"){if(q[r].format&&q[r].format=="date"){B[s].data[r].value=(new Date(q[r].value)).getTime()/1000}else{B[s].data[r].value=q[r].value}}}if(q[r].signal){F=JSON.parse(t[r]);if(F=="datum"){F=JSON.stringify(B[s].original)}D=C[r]||"data";if(typeof B[s][D][r]==="undefined"){B[s][D][r]={}}try{B[s][D][r].value=d(F,B[s].data)}catch(x){E.log.error("Unable to parse signal",B[s].data,F)}if(r=="tooltip"){if(typeof B[s].props[r].value==="object"){y="<table>";for(w in B[s].props[r].value){if(typeof B[s].props[r].value[w]!=="undefined"&&B[s].props[r].value[w]!=""){y+="<tr><td>"+w+":</td><td>"+B[s].props[r].value[w]+"</td></tr>"}}B[s].props[r]=y+"</table>"}else{B[s].props[r]=B[s].props[r].value}}}}}}if(typeof u==="number"){return B[u]}else{return B}}function k(r,s){var q={menu:'<path style="fill:%COLOUR%;fill-opacity: 0.8;" d="M 5,6 l 22,0 0,4 -22,0 0,-4 M 5,14 l 22,0 0,4 -22,0 0,-4 M 5,22 l 22,0 0,4 -22,0 0,-4 " />',fit:'<path style="fill:%COLOUR%" d="M 0,12 L0,0 12,0 12,4 6,4 12,10 10,12 4,6 4,12 M20,0 L 32,0 32,12 28,12 28,6 22,12 20,10 26,4 20,4 20,0 M 20,32 L20,28 26,28 20,22 22,20 28,26 28,20 32,20, 32,32 20,32 M 12,32 L 0,32 0,20 4,20 4,26 10,20 12,22 6,28 12,28 12,32" />',layers:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,6 l 12,6.5 -12,6.5 -12,-6.5Z" /><path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,10.5 l 12,6.5 -12,6.5 -12,-6.5 Z" /><path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,15 l 12,6.5 -12,6.5 -12,-6.5 Z" />',views:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 5,5 l 10,0 0,10 -10,0 0,-2 4,0 0,-2.5 2,0 0,2.5 1,0 0,-5 -1,-1 -2,0 -1,1 3,0 0,1.5 -2,0 0,-1.5 -1,0 0,5 -3,0Z M 17,5 l 10,0 0,10 -10,0 0,-2 6,0 1,-1 0,-1 -1,-1 1,-1 0,-1 -1,-1 -2,0 0,1 2,0 0,1 -0.5,0.5 -1.5,0 0,1 1.5,0 0.5,0.5 0,1 -2,0 0,-5 -1,0 0,6 -3,0Z M 5,17 l 10,0 0,10 -10,0 0,-2 4,0 3,0 0,-1 -3,0 0,-4 3,0 0,-1 -3,0 -1,1 0,4 1,1 -4,0Z M 17,17 l 10,0 0,10 -10,0 0,-2 6,0 1,-1 0,-4 -1,-1 -3,0 0,1 3,0 0,4 -2,0 0,-4 -1,0 0,5 -3,0Z" />',config:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 13.971 4.5996 L 13.377 7.6992 L 13.453 7.6992 A 8.661 8.661 0 0 0 12.008 8.291 L 9.4785 6.5 L 6.5781 9.4004 L 8.3926 11.865 A 8.661 8.661 0 0 0 7.707 13.551 L 7.707 13.4 L 4.6074 13.9 L 4.6074 18 L 7.707 18.5 L 7.707 18.361 A 8.661 8.661 0 0 0 8.3945 20.033 L 6.5781 22.5 L 9.4785 25.4 L 12.01 23.609 A 8.661 8.661 0 0 0 13.395 24.189 L 13.971 27.199 L 18.033 27.199 L 18.547 24.215 A 8.661 8.661 0 0 0 20.014 23.621 L 22.529 25.4 L 25.43 22.5 L 23.635 20.059 A 8.661 8.661 0 0 0 24.289 18.496 L 27.369 18 L 27.369 13.9 L 24.283 13.402 A 8.661 8.661 0 0 0 23.631 11.848 L 25.43 9.4004 L 22.529 6.5 L 20.01 8.2832 A 8.661 8.661 0 0 0 18.564 7.6836 L 18.033 4.5996 L 13.971 4.5996 z M 15.988 10.828 A 5.0719 5.0719 0 0 1 21.061 15.9 A 5.0719 5.0719 0 0 1 15.988 20.973 A 5.0719 5.0719 0 0 1 10.916 15.9 A 5.0719 5.0719 0 0 1 15.988 10.828 z" />',save:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 6,26 l 20,0 0,-6 -6,0 -4,3 -4,-3 -6,0 Z M 16,20 l 8,-8 -5,0 0,-6 -6,0 0,6 -5,0" />',about:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,24 m -3,0 c 0,-4 6,-4 6,0 c 0,4 -6,4 -6,0 Z M 13,19 l 6,0 0,-4 c 6,0 6,-11 -3,-11 c -3,0 -8,2 -8,8 l 4,0 c 2,-10 11,0 2,2Z" />'};return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">'+(q[r]||"").replace(/%COLOUR%/g,(s||"black"))+"</svg>"}function b(w,q){q=(q||",");var v=new RegExp(("(\\"+q+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+q+"\\r\\n]*))"),"gi");var u=[[]];var t=false;while(t=v.exec(w)){var s=t[1];if(s.length&&s!==q){u.push([])}var r;if(t[2]){r=t[2].replace(new RegExp('""',"g"),'"')}else{r=t[3]}u[u.length-1].push(r)}return u}function m(u,w){if(typeof u==="string"){u=b(u)}var r,q,x,s,t;var v=[];q=new Array(u[0].length);x=new Array(u[0].length);for(s=0;s<u[0].length;s++){x[s]=u[0][s];q[s]=w[x[s]]||"string"}for(t=1;t<u.length;t++){if(!u[t]||u[t]==""){continue}r={};for(s=0;s<u[t].length;s++){if(q[s]=="number"){r[x[s]]=parseFloat(u[t][s])}else{r[x[s]]=u[t][s]}}v.push(r)}return v}function g(q,r){if(!r){r=2}q=q+"";while(q.length<r){q="0"+q}return q}var p="function zeroPad(d,n){ if(!n){ n = 2;} d = d+''; while(d.length < n){ d = '0'+d; } return d; };";p+="function timeFormat(t,f){ var d,micros,ds,dl,m,ms,ml; d = new Date(t*1000); micros = ''; m = (t+'').match(/\\.[0-9]{3}([0-9]+)/);if(m && m.length==2){ micros = m[1]; }; ds = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']; dl = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']; ms = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; ml = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; return f.replace(/%a/g,ds[d.getDay()]).replace(/%Y/g,d.getFullYear()).replace(/%a/g,dl[d.getDay()]).replace(/%b/g,ms[d.getMonth()]).replace(/%B/g,ml[d.getMonth()]).replace(/%d/g,(d.getDate().length==1 ? '0':'')+d.getDate()).replace(/%m/,(d.getMonth()+1)).replace(/%H/,zeroPad(d.getUTCHours())).replace(/%M/,zeroPad(d.getUTCMinutes())).replace(/%S/,zeroPad(d.getUTCSeconds())).replace(/%L/, (zeroPad(d.getUTCMilliseconds(),3)+micros).replace(/([0-9])0+$/,function(m,p1){ return p1; }));};";p+="function datetime(y,m,d,h,mn,sc,ms){ return (new Date(y+'-'+zeroPad(m+1,2)+'-'+(typeof d==='number' ? zeroPad(d,2):'01')+(typeof h==='number' ? 'T'+(zeroPad(h,2)+':'+(typeof mn==='number' ? zeroPad(mn,2)+(typeof sc==='number' ? ':'+zeroPad(sc,2)+(ms ? '.'+zeroPad(ms,3):''):''):'00'))+'Z':''))).valueOf()/1000; };";p+="function date(d){ return (new Date(d)).getTime()/1000; };";function d(r,s){if(typeof s==="object"){for(var q in s){if(typeof s[q]=="object"&&s[q].type=="Num"){s[q]=(typeof s[q].toValue==="function")?s[q].toValue():s[q].v}}}return Function('"use strict";'+p+"var datum = "+JSON.stringify(s)+"; return ("+r+")")()}function h(q){return JSON.parse(JSON.stringify(q))}l.AASTimeSeriesEmbed=function(s,r,q){var t=TimeSeries.create(r,q);t.initialize(S(s)[0]);return};function e(s,r,t){if(typeof s==="number"){s=Num(s)}var q=new o(s,r);if(t=="jd"){return q.toJD()}else{if(t=="mjd"){return q.toMJD()}else{if(t=="tjd"){return q.toTJD()}else{if(t=="unix"){return q.toUNIX()}else{if(t=="seconds"){return q.toSeconds()}else{if(t=="iso"){return q.toDate().toISOString()}}}}}}return 0}function o(r,q){this.epoch={jd:2440587.5,mjd:2400000.5,tjd:2440000.5};this.d2ms=86400000;if(typeof r==="number"){r=Num(r)}if(q=="jd"){this.jd=r}if(q=="mjd"){this.jd=r.plus(this.epoch.mjd)}if(q=="tjd"){this.jd=r.plus(this.epoch.tjd)}if(q=="unix"){this.unix=r}if(q=="iso"||q=="locale"||!q){this.unix=r.times(1000)}this.toJD=function(){if(this.jd){return this.jd.toValue()}if(this.unix){return this.unix.div(this.d2ms).plus(this.epoch.jd).toValue()}return 0};this.toUNIX=function(){if(this.unix){return this.unix.toValue()}if(this.jd){return this.jd.minus(this.epoch.jd).times(this.d2ms).toValue()}return 0};this.toSeconds=function(){if(this.unix){return this.unix.div(1000).toValue()}if(this.jd){return this.jd.minus(this.epoch.jd).times(this.d2ms).div(1000).toValue()}return 0};this.toMJD=function(){if(this.unix){this.jd=this.unix.div(this.d2ms).plus(this.epoch.jd)}if(this.jd){return this.jd.minus(this.epoch.mjd).toValue()}else{return 0}};this.toTJD=function(){if(this.unix){this.jd=this.unix.div(this.d2ms).plus(this.epoch.jd)}if(this.jd){return this.jd.minus(this.epoch.tjd).toValue()}else{return 0}};this.toDate=function(){if(this.jd){return new Date(this.toUNIX())}if(this.unix){return new Date(this.unix.toValue())}return new Date()};return this}function n(t){var s=0,r=0,q=t;do{s+=q.offsetTop||0;r+=q.offsetLeft||0;q=q.offsetParent}while(q);return(window.scrollY+window.innerHeight+20>s&&window.scrollY<s+t.offsetHeight)}l.TimeSeries=TimeSeries})(window||this);