(function(n){var k="";function g(){this.version="0.0.10";this.create=function(v,u){if(!u){u={}}if(typeof u.logging!=="boolean"){u.logging=this.logging}return new b(v,u)};this.load={resources:{files:{},callbacks:[]},data:{files:{},callbacks:[]}};this.callback="";this.logging=(location.search.indexOf("logging=true")>0);var r=document.getElementsByTagName("script");var s=r[r.length-1].src.split("?")[0];var q=s.lastIndexOf("/");k=(q>=0)?s.substr(0,q+1):"";var t=this;this.log=function(){if(this.logging||arguments[0]=="ERROR"){var u=Array.prototype.slice.call(arguments,0);if(console&&typeof console.log==="function"){if(arguments[0]=="ERROR"){console.log("%cERROR%c %cTimeSeries%c: "+u[1],"color:white;background-color:#D60303;padding:2px;","","font-weight:bold;","",(u.splice(2).length>0?u.splice(2):""))}else{console.log("%cTimeseries%c","font-weight:bold;","",u)}}}return this};if(console){console.log("%ctimeseries.js v"+this.version+"%c","font-weight:bold;font-size:1.25em;","")}this.filesLoaded=function(u){this.log("filesLoaded",u,this.load.data);var w=0;for(var v=0;v<u.length;v++){if(this.load.data.files[u[v]]&&this.load.data.files[u[v]].loaded){w++}}return(w==u.length)};this.loadFromDataFile=function(w,u,v){this.log("loadFromDataFile",w,u,v);u.file=w;if(!this.load.data.files[w]){this.load.data.files[w]={loaded:false,callbacks:[]};this.load.data.files[w].callbacks.push({fn:v,attr:u});this.log("loading data",w);S().ajax(w,{dataType:"text","this":this,file:w,success:function(A,y){A=A.replace(/[\n\r]$/,"");var x=this.load.data.files[y.file].callbacks;this.log("CALLBACKS",y.file,x);for(var z=0;z<x.length;z++){this.load.data.files[x[z].attr.file].data=A;this.load.data.files[x[z].attr.file].loaded=true;if(typeof x[z].fn==="function"){x[z].fn.call(x[z].attr["this"],this.load.data.files[x[z].attr.file].data,x[z].attr)}}},error:function(A,y){var x=this.load.data.files[y.file].callbacks;for(var z=0;z<x.length;z++){x[z].attr["this"].error("Failed to load",y.file,A)}}})}else{if(!this.load.data.files[w].loaded){this.load.data.files[w].callbacks.push({fn:v,attr:u})}else{if(typeof v==="function"){v.call(u["this"],this.load.data.files[w].data,u)}}}};this.loadResources=function(x,u,y){this.log("loadResources",x);if(typeof x==="string"){x=[x]}this.load.resources.callbacks.push({callback:y,attr:u});function v(z,B){var A=0;for(var C=0;C<z.length;C++){if(TimeSeries.load[B].files[z[C]].loaded){A++}}t.log("checkAndGo",A,z.length,TimeSeries.load[B].callbacks);if(A==z.length){for(var D=TimeSeries.load[B].callbacks.length-1;D>=0;D--){t.log("Processing callback "+D+" for "+B,TimeSeries.load[B].callbacks);TimeSeries.load[B].callbacks[D].callback.call((TimeSeries.load[B].callbacks[D].attr["this"]||TimeSeries),{data:TimeSeries.load[B].callbacks[D].attr});TimeSeries.load[B].callbacks.pop()}}}for(var w=0;w<x.length;w++){if(!this.load.resources.files[x[w]]){this.log("loading resource",x[w]);this.log("start loading "+x[w]+" is ",this.load.resources.files[x[w]]);this.load.resources.files[x[w]]={loaded:false};this.loadCode(x[w],{me:this,files:x,callback:v},function(z){z.data.me.load.resources.files[z.url].loaded=true;z.data.me.log("loaded resource "+z.url);z.data.callback.call(this,z.data.files,"resources")})}else{this.log("current state of "+x[w]+" is ",this.load.resources.files[x[w]])}}return this};this.loadCode=function(v,u,x){var w;if(typeof u==="function"&&!x){x=u}this.log("loadCode",v,x);if(v.indexOf(".js")>=0){w=document.createElement("script");w.setAttribute("type","text/javascript");w.src=v}else{if(v.indexOf(".css")>=0){w=document.createElement("style");w.setAttribute("rel","stylesheet");w.setAttribute("type","text/css");w.setAttribute("href",v)}}if(w){w.onload=function(){x.call(t,{url:v,data:(u||{})})};document.getElementsByTagName("head")[0].appendChild(w)}return t};return this}TimeSeries=new g();function b(r,q){if(!q){q={}}this.attr=q;if(typeof r==="object"){this.json=r;this.vega=JSON.parse(JSON.stringify(r))}else{if(typeof r==="string"){this.file=r}}this.logging=q.logging||false;if(typeof q.showaswego==="undefined"){q.showaswego=false}this.log("TS",r);this.options={xaxis:{title:"Time",log:false,fit:true},yaxis:{title:"y-axis",log:false},grid:{hoverable:true,clickable:true,color:"#888888"},labels:{color:"#000000"},fit:false,tooltip:{theme:"aas-theme"},showaswego:q.showaswego};this.dateformats={"default":{title:"Default"},relative:{title:"Relative date",formatLabel:function(u,B){var w,F,E,A,C,x,z,t,D,y;w=(u<0)?-1:1;u=Math.abs(u);F=u*1;if(u==0){return{str:"0"}}D=["y","d","h","m","s","ms"];A={y:86400*365.25*1000,d:86400*1000,h:3600*1000,m:60*1000,s:1000,ms:1};if(u<A.ms){return{str:(w<0?"-":"")+(u/1000)}}C="";x={};for(z=0,y=0;z<D.length;z++){y=0;t=A[D[z]];if(F>=t&&F>0){y=Math.floor(F/t)}if(D[z]=="y"&&u>=t){C+=y+"y"}if(D[z]=="d"&&u>=t&&y>0){C+=(C?" ":"")+y+"d"}if(D[z]=="h"&&u>=A.m&&F>0){C+=(C?" ":"")+h(y,2)+":";x.m=true}if(D[z]=="m"&&x.m){C+=h(y,2)}if(D[z]=="s"&&F>0){C+=(u<A.m?y:":"+h(y,2))}if(D[z]=="ms"&&F>0&&y>0){C+="."+h(y,3).replace(/0+$/,"")}F-=y*t}return{str:(w<0?"-":"")+C}}},locale:{title:"Locale",formatLabel:function(t){var u=new Date(parseInt(t));return{str:u.toLocaleString()}}},jd:{title:"Julian date",scale:86400000,formatLabel:function(t){return{str:p(parseFloat(t),"jd")+""}}},mjd:{title:"Modified Julian date",scale:86400000,formatLabel:function(t){var u=p(parseInt(t),"mjd");var v={str:u+""};v.truncated=u.toPrecision(this.x.precisionlabel+1);return v}},tjd:{title:"Truncated Julian date",scale:86400000,formatLabel:function(u,t){var w=p(parseInt(u),"tjd");if(t.dp>0){w=w.toFixed(t.dp)}var v={str:w+""};return v}}};this.datasets=[];this.directory="";for(var s in q){if(q[s]){if(s=="directory"){this[s]=q[s]}if(s=="fit"||s=="tooltip"){this.options[s]=q[s]}}}if(this.json){this.processJSON(r)}return this}b.prototype.log=function(){if(this.logging||arguments[0]=="ERROR"){var q=Array.prototype.slice.call(arguments,0);if(console&&typeof console.log==="function"){if(arguments[0]=="ERROR"){console.log("%cERROR%c TS: "+q[1],"color:white;background-color:#D60303;padding:2px;","",(q.splice(2).length>0?q.splice(2):""))}else{console.log("%cTS%c","font-weight:bold;","",q)}}}return this};b.prototype.processJSON=function(s){this.json=s;this.vega=JSON.parse(JSON.stringify(s));this.log("processJSON",s,this.json);if(s.width){this.options.width=s.width}if(s.height){this.options.height=s.height}if(s.padding){this.options.padding=s.padding}if(s.axes){for(var q=0;q<s.axes.length;q++){var r="";if(s.axes[q].orient=="bottom"){r="xaxis"}if(s.axes[q].orient=="left"){r="yaxis"}if(r){this.options[r]=s.axes[q]}}}this.options.logging=true;return this};b.prototype.postProcess=function(){this.log("postProcess",this);var r,q,t;if(this.options.fit){this.options.width=this.initializedValues.w;this.options.height=this.initializedValues.h}this.options.logging=this.logging;this.options.logtime=(location.search.indexOf("logtime=true")>0);this.options.xaxis.mode="time";this.options.scrollWheelZoom=true;if(this.json.scales){for(q=0;q<this.json.axes.length;q++){for(r=0;r<this.json.scales.length;r++){if(this.json.axes[q].scale==this.json.scales[r].name){t=(this.json.axes[q].orient=="left"?"yaxis":"xaxis");if(this.json.scales[r].type=="log"){this.options[t].log=true}if(this.json.scales[r].range){this.options[t].range=this.json.scales[r].range}if(this.json.scales[r].domain){this.options[t].domain=i(this.json.scales[r].domain);for(d=0;d<this.options[t].domain.length;d++){if(this.options[t].domain[d].signal){this.options[t].domain[d]=c(this.options[t].domain[d].signal)}}}}}}}this.graph=new Graph(this.el,[],this.options);var s=S(this.el);var u='<div class="loader"><div class="spinner">';for(r=1;r<6;r++){u+='<div class="rect'+r+' seasonal"></div>'}u+="</div></div>";s.addClass("timeseries").append(u);this.makeMenu();if(this.json){this.loadDatasets(this.json.data)}return this};b.prototype.makeMenu=function(){var s,q,u,v,t,x,w,y,r;s=S(this.el);q=s.attr("id");if(s.find(".menuholder").length==0){r=[{key:"views",title:"Views",html:'<ol class="views"></ol>'},{key:"layers",title:"Marker layers",html:'<ol class="layers"></ol>',on:true},{key:"config",title:"Options",html:'<div class="row"><button class="fullscreen icon" title="Toggle fullscreen">'+m("fit")+'</button><button class="autozoom">Zoom to data</button></div><div class="row"><button class="fontup">A&plus;</button><button class="fontreset">A</button><button class="fontdn">A&minus;</button></div>'},{key:"save",title:"Save",html:'<button class="savepng" data="white">Save as PNG</button><button class="savepng">Save as transparent PNG</button><button class="savevega">Save as JSON (VEGA-compatible)</button><button class="editvega">Open in VEGA Editor</button><br style="clear:both;">'}];x="";w="";for(v=0;v<r.length;v++){x+='<li class="submenu-'+r[v].key+'"><button '+(r[v].on?'class="on" ':"")+'data="submenu-'+r[v].key+'" title="'+r[v].title+'">'+m(r[v].key,"white")+"</button></li>";w+=(r[v].html?'<div class="menu-panel submenu-'+r[v].key+(r[v].on?" on":"")+'">'+r[v].html+"</div>":"")}x+="<li></li>";s.prepend('<div class="menuholder"><input type="checkbox" id="'+q+'_hamburger" class="hamburger"><label for="'+q+'_hamburger" class="hamburger">'+m("menu","white")+'<span class="nv">Toggle menu (if not visible)</span></label><menu class="timeseries-actions-wrapper"><ul class="submenu">'+x+"</ul>"+w+"</menu></div>");for(v=0;v<r.length;v++){if(r[v].on){s.find("submenu-"+r[v].key).addClass("on")}}s.find(".menuholder").on("mouseover",function(){S(".graph-tooltip").css({display:"none"})});s.find("#"+q+"_hamburger").on("click",{me:this},function(A){var z=(this[0].checked?0:-1);this.parent().find("menu button, menu a").attr("tabIndex",z)});s.find("button.fullscreen").on("click",{g:this.graph},function(z){z.data.g.toggleFullScreen()});s.find("button.autozoom").on("click",{g:this.graph},function(z){z.data.g.zoom()});s.find("button.fontup").on("click",{g:this.graph},function(z){z.data.g.scaleFont(+1)});s.find("button.fontdn").on("click",{g:this.graph},function(z){z.data.g.scaleFont(-1)});s.find("button.fontreset").on("click",{g:this.graph},function(z){z.data.g.scaleFont(0)});s.find("button.savevega").on("click",{me:this},function(z){z.data.me.save("vega")});s.find("button.editvega").on("click",{me:this},function(z){z.data.me.save("vegaeditor")});s.find("button.savepng").on("click",{me:this},function(z){z.data.me.save("png",{background:S(z.currentTarget).attr("data")})});s.find(".submenu button").on("click",{el:s},function(B){B.data.el.find(".on").removeClass("on");var A=S(B.currentTarget);var z=A.attr("data");A.addClass("on");B.data.el.find(".menu-panel."+z).addClass("on")});w='<div class="row"><label for="'+q+'_dateformat">Date format: </label><select id="'+q+'_dateformat">';for(u in this.dateformats){if(this.dateformats[u]){f=(this.json._date||this.json._dateformat||"default");w+='<option value="'+u+'"'+(u==f?' selected="selected"':"")+">"+this.dateformats[u].title+"</option>";if(f&&this.dateformats[f]){this.graph.x.labelopts=this.dateformats[f]}}}w+="</select></div>";s.find(".menu-panel.submenu-config").append(w);s.find("#"+q+"_dateformat").on("change",{graph:this.graph,formats:this.dateformats},function(z){if(z.data.formats[this[0].value]){z.data.graph.x.labelopts=z.data.formats[this[0].value];z.data.graph.defineAxis("x").calculateData().draw(true)}})}};b.prototype.initialize=function(t,u){this.log("initialize",t);if(typeof u==="function"){this.callback=u}if(!t){this.log("ERROR",t,u)}var r=S(t);if(r.length==0){return this}this.el=t;this.log("load",t,r,this.options.fit);var s=r.attr("vega-src");if(s){this.file=s}if(!this.file){this.file=""}if(typeof this.file!=="string"){return this}if(typeof this.initializedValues==="undefined"){this.initializedValues={w:t.clientWidth,h:t.clientHeight}}if(typeof Graph==="undefined"&&typeof Graph!=="function"){TimeSeries.loadResources(k+"graph.js",{"this":this,el:t},function(v){this.log("loadedResources",v,this);this.initialize(v.data.el)})}else{if(this.file){var q=this.file.lastIndexOf("/");this.directory=(q>=0)?this.file.substr(0,q+1):"";S().ajax(this.file,{dataType:"json","this":this,cache:true,success:function(w,v){this.processJSON(w);this.postProcess();return this},error:function(v){this.error("Unable to load configuration",this.file,v)}})}else{this.postProcess();return this}}return this};b.prototype.loadDatasets=function(v){this.log("loadDatasets",v);if(!v){return this}this.datasets={};var w,u,t,s,r,q;w=v.length;u="";t=[];s=function(z,x){var y;typ="json";if(x&&x.dataset&&x.dataset.format&&x.dataset.format.type=="csv"){typ="csv"}if(typ=="csv"){y=o(z,x.dataset.format.parse)}else{if(typ=="json"){y=z[0]}}this.datasets[x.dataset.name]={json:y,parse:x.dataset.format.parse};this.datasets[x.dataset.name][typ]=z;this.update(x.dataset.name);if(TimeSeries.filesLoaded(x.files)){this.loaded()}};for(r=0;r<w;r++){if(v[r].url){t.push(this.directory+v[r].url)}}this.log("files",t,TimeSeries.filesLoaded(t));for(r=0;r<w;r++){if(v[r].values){s.call(this,v[r].values,{dataset:v[r],files:t})}}for(q=0;q<t.length;q++){TimeSeries.loadFromDataFile(t[q],{"this":this,dataset:v[q],files:t},s)}return this};b.prototype.update=function(s){var w,v,q,u;this.olddatasetsused=this.datasetsused;this.datasetsused="";this.log("update",s);function t(C,z){var x={size:"props",shape:"props",fill:"props",fillOpacity:"props",stroke:"props",strokeOpacity:"props",strokeWidth:"props",strokeCap:"props",strokeDash:"props",width:"props",height:"props",tooltip:"props",font:"props",fontSize:"props",fontWeight:"props",fontStyle:"props",baseline:"props",align:"props",dx:"props",angle:"props",limit:"props"};if(!C){console.log("updateProps fail",C,z);return}datum=C.data;for(var B in z){if(z[B]){if(x[B]&&x[B]=="props"){if(typeof z[B].value!=="undefined"){if(C.props.symbol){C.props.symbol[B]=z[B].value}if(C.props.format){C.props.format[B]=z[B].value}}}else{if(typeof datum[B]==="undefined"){datum[B]=i(z[B])}if(z[B].field){if(typeof z[B].field==="string"){if(typeof datum[z[B].field]!=="undefined"){C.data[B]=datum[z[B].field]}}else{if(typeof z[B].field==="object"){C.data[B]=i(z[B])}}}if(typeof z[B].value!=="undefined"){if(z[B].format&&z[B].format=="date"){datum[B].value=(new Date(z[B].value)).getTime()}else{datum[B].value=z[B].value}}}if(z[B].signal){to=x[B]||"data";if(typeof C[to][B]==="undefined"){C[to][B]={}}try{C[to][B].value=c(z[B].signal)}catch(A){u.log("Error",C.data,z[B])}if(B=="tooltip"){if(typeof C.props[B].value==="object"){str="<table>";for(var y in C.props[B].value){if(typeof C.props[B].value[y]!=="undefined"){str+="<tr><td>"+y+":</td><td>"+C.props[B].value[y]+"</td></tr>"}}C.props[B]=str+"</table>"}else{C.props[B]=C.props[B].value}}}}}return C}function r(y,x,C){var B="";if(C.from&&C.from.data){B=C.from.data;if(y.datasets[B]){y.datasetsused+=B}}if((!B||y.datasets[B])&&!y.graph.marks[x]){var A=C.description||"Markers "+(x+1);var z={title:B,id:B,name:(C.name||""),desc:A,type:C.type,clickable:true,css:{"background-color":"#000000"},include:(typeof C.include==="boolean"?C.include:true)};if(C.type=="symbol"){z.symbol={show:true}}else{if(C.type=="rect"){z.rect={show:true}}else{if(C.type=="line"){z.lines={show:true}}else{if(C.type=="rule"){z.rule={show:true}}else{if(C.type=="area"){z.area={show:true}}else{if(C.type=="text"){z.text={show:true}}}}}}}if(y.datasets[B]){z.data=i(y.datasets[B].json);z.parse=y.datasets[B].parse}else{z.data=[{props:{x:0,y:0,x2:0,y2:0}}];z.parse={}}if(z){if(C.encode&&C.encode.hover){z.hoverable=true;if(C.encode.hover.fill){z.css["background-color"]=C.encode.hover.fill.value}}z.encode=C.encode;if(C.encode.enter){z.enter=function(D,E){return t(D,E)}}if(C.encode.update){z.update=function(D,E){return t(D,E)}}if(C.encode.hover){z.hover=function(D,E){return t(D,E)}}z.clip=(C.clip||false);y.graph.addMarks(z,x);if(y.datasets[B]){y.datasets[B].added=true}}else{y.log("No dataset built for "+B,C)}}return y}for(w in this.datasets){if(this.datasets[w]&&!this.datasets[w].data){this.datasets[w].data=this.datasets[w].json}}this.graph.addDatasets(this.datasets);for(q=0;q<this.json.marks.length;q++){v=this.json.marks[q];r(this,q,v)}if(this.json._extramarks){for(q=0;q<this.json._extramarks.length;q++){v=i(this.json._extramarks[q]);v.include=false;r(this,q+this.json.marks.length+q,v)}}if(this.datasetsused!=this.olddatasetsused&&this.attr.showaswego){this.graph.updateData()}return this};b.prototype.updateLayerMenu=function(){var D,z,s,B,y,C,x,E,v,F,K,t,H,J,A,G,u,I,q,r;s=this.graph.canvas.container.find(".layers");t={};H={};j=1;for(D in this.graph.marks){if(this.graph.marks[D]){z=S(this.el).attr("id")+"_"+D;K=this.graph.marks[D].desc;if(typeof t[K]==="undefined"){t[K]=[]}t[K].push(D);j++}}j=0;for(K in t){if(typeof t[K]!=="undefined"){z=S(this.el).attr("id")+"_"+j;F=this.graph.marks[t[K][0]];r=false;if(s.find("#"+z).length==0){s.append('<li><input type="checkbox" checked="checked" id="'+z+'" data="'+K+'" /><label for="'+z+'"><span class="key" style="background-color:'+F.format.fill+";"+(F.type=="area"&&F.format.fillOpacity?"opacity:"+F.format.fillOpacity+";":"")+'"></span>'+K+"</label></li>");r=true}B=s.find("#"+z);y=B.parent();C=y.find(".key");if(r){B.on("change",{me:this,k:t[K]},function(N){var M,L,w;M=N.data.me.graph;for(L=0;L<N.data.k.length;L++){w=N.data.k[L];M.marks[w].show=!M.marks[w].show}M.calculateData().draw(true);if(this.parent().find("input")[0].checked){this.parent().removeClass("inactive")}else{this.parent().addClass("inactive")}}).on("focus",{layers:s},function(w){w.data.layers.find("li").removeClass("on").removeClass("selected");this.parent().addClass("on")});s.on("mouseover",{layers:s},function(w){w.data.layers.find(".selected").removeClass("selected")});H[t[K][0]]=B.parent();v=false;for(D=0;D<t[K].length;D++){if(["symbol","rect","line","rule","text","area"].indexOf(F.type)>=0){v=true}}if(v&&C&&C[0]){x=C[0].offsetWidth;E=C[0].offsetHeight;C.html('<canvas style="width:'+x+"px;height:"+E+'px;"></canvas>')}}if(y.find("canvas").length==1){G=y.find("canvas")[0];x=parseInt(y.find("canvas").css("width"));E=parseInt(y.find("canvas").css("height"));A=G.getContext("2d");J=window.devicePixelRatio;G.width=x*J;G.height=E*J;A.scale(J,J);A.clearRect(0,0,x,E);A.fillStyle="#ffffff";A.rect(0,0,x,E);A.fill();for(D=0;D<t[K].length;D++){F=this.graph.marks[t[K][D]];if(F.include){C.css({"background-color":"none"});this.graph.setCanvasStyles(A,F.mark[0]);if(F.type=="symbol"){this.graph.drawShape(i(F.mark[0]),{ctx:A,x:x/2,y:E/2})}else{if(F.type=="rect"){if(F.mark[0].props.x1&&F.mark[0].props.x2&&F.mark[0].props.y1&&F.mark[0].props.y2){this.graph.drawRect(i(F.mark[0]),{ctx:A,x1:0,y1:0,x2:x,y2:E})}else{this.graph.drawRect(i(F.mark[0]),{ctx:A,x1:x/2,y1:0,x2:x/2,y2:E})}}else{if(F.type=="area"){this.graph.drawRect(i(F.mark[0]),{ctx:A,x1:0,y1:0,x2:x,y2:E})}else{if(F.type=="line"){A.beginPath();A.moveTo(0,E/2);A.lineTo(x,E/2);A.lineWidth=(F.encode.enter.strokeWidth.value||0.8);A.stroke()}else{if(F.type=="rule"){A.beginPath();A.lineWidth=(F.encode.enter.strokeWidth.value||1);if(F.data[0].y.value==F.data[0].y2.value){A.moveTo(0,E/2+0.5);A.lineTo(x,E/2+0.5)}else{if(F.data[0].x.value==F.data[0].x2.value){A.moveTo(x/2+0.5,0);A.lineTo(x/2+0.5,E)}else{A.moveTo(0,0);A.lineTo(x,E)}}A.stroke()}else{if(F.type=="text"){this.graph.drawTextLabel("T",x/2,E/2,{ctx:A,format:{align:"center",baseline:"middle"}})}}}}}}}}}q=false;I=false;for(D=0;D<t[K].length;D++){if(this.graph.marks[t[K][D]].include){q=true}if(this.graph.marks[t[K][D]].show){I=true}}u=s.find("#"+z).parent();u.css({display:(q?"block":"none")});if(I){u.removeClass("inactive")}else{u.addClass("inactive")}}j++}this.graph.on("hoverpoint",{lookup:H,layers:s},function(L){L.data.layers.find("li").removeClass("selected");if(L.matches.length==0){return}for(var w=0;w<L.matches.length;w++){if(L.data.lookup[L.matches[w].series]){L.data.lookup[L.matches[w].series].addClass("selected")}}});return this};b.prototype.updateViewMenu=function(){var v,x,z,w,r,q,y,t,u;u="abcdefghijklmnopqrstuvwxyz";r=this.graph.canvas.container.find(".views");y=this.graph.canvas.container.find(".submenu-views");if(!this.json._views||(this.json._views&&this.json._views.length<2)){r.css({display:"none"});y.css({display:"none"});return this}else{r.css({display:""});y.css({display:""})}t=0;for(v=0;v<this.json._views.length;v++){if(this.json._views[v].active){t=this.json._views[v].active}}this.json._views[t].active=true;for(v=0;v<this.json._views.length;v++){q=S(this.el).attr("id")+"-view-"+v;if(r.find("#"+q).length==0){r.append("<li "+(this.json._views[v].active?' class="selected"':"")+'><input type="radio"'+(this.json._views[v].active?' checked="checked"':"")+' id="'+q+'" name="'+S(this.el).attr("id")+'-view" data="'+v+'" /><label for="'+q+'" title="'+this.json._views[v].description+'"><span style="font-family:monospace;">'+u.substr(v,1).toUpperCase()+".</span> "+this.json._views[v].title+"</label></li>");l=r.find("#"+q);l.on("change",{me:this,id:q,i:v,el:r},function(G){var D,B,F,A,C,E,H;F=G.data.me.graph;D=G.data.me.json;B=G.data.me.json._views[G.data.i];for(A=0;A<D.axes.length;A++){if(B.scales){for(E=0;E<B.scales.length;E++){if(D.axes[A].scale==B.scales[E].name){axis=(D.axes[A].orient=="left"?"yaxis":"xaxis");F.options[axis].log=(B.scales[E].type=="log");if(B.scales[E].range||D._views[0].scales[E].range){F.options[axis].range=i((B.scales[E].range)?B.scales[E].range:D._views[0].scales[E].range)}if(D._views[0].scales[E].domain||B.scales[E].domain){F.options[axis].domain=i(B.scales[E].domain?B.scales[E].domain:D._views[0].scales[E].domain);for(H=0;H<F.options[axis].domain.length;H++){if(F.options[axis].domain[H].signal){F.options[axis].domain[H]=c(F.options[axis].domain[H].signal)}}}}}}}for(C in F.marks){if(F.marks[C]){found=-1;F.marks[C].include=false;for(E=0;E<B.markers.length;E++){if(F.marks[C].name==B.markers[E].name){found=E;F.marks[C].include=true;F.marks[C].show=B.markers[E].visible}}}}G.data.me.updateLayerMenu();F.updateData();G.data.el.find(".selected").removeClass("selected");if(this.parent().find("input")[0].checked){this.parent().addClass("selected")}}).on("focus",{el:r},function(s){s.data.el.find("li").removeClass("on");this.parent().addClass("on")})}}return this};b.prototype.loaded=function(){this.log("loaded",this.attr.showaswego,this.graph.marks);var q,r,s;if(this.attr.showaswego==false){this.graph.updateData()}this.graph.canvas.container.find(".loader").remove();if(!this.json._views){this.json._views=[]}s=false;for(r=0;r<this.json._views.length;r++){if(this.json._views[r].name=="default"){s=true}}if(!s){q={name:"default",title:"Default",description:"The initial view",markers:[],scales:i(this.json.scales)};for(r=0;r<this.json.marks.length;r++){q.markers.push({name:this.json.marks[r].name,include:true,visible:true})}this.json._views.unshift(q)}this.updateLayerMenu();this.updateViewMenu();if(typeof this.callback==="function"){this.callback.call(this)}return this};b.prototype.save=function(t,r){if(typeof Blob!=="function"){return this}var v={type:"text/text",file:(this.file?this.file.replace(/.*\//g,""):"timeseries.json")};if(!r){r={}}function u(z){var w=new Blob([z],{type:v.type});function x(A){document.body.removeChild(A.target)}var y=document.createElement("a");y.download=v.file;y.innerHTML="Download File";if(window.webkitURL!=null){y.href=window.webkitURL.createObjectURL(w)}else{y.href=window.URL.createObjectURL(w);y.onclick=x;y.style.display="none";document.body.appendChild(y)}y.click()}var q;if(t=="vega"||t=="vegaeditor"){output=i(this.vega);for(var s=0;s<output.data.length;s++){delete output.data[s].url;typ="json";if(this.datasets[output.data[s].name].csv){typ="csv"}output.data[s].values=this.datasets[output.data[s].name][typ]}q=JSON.stringify(output)}if(t=="vega"){v.type="text/json";v.file=(this.file?this.file.replace(/.*\//g,""):(r.file||"timeseries.json"));u(q)}if(t=="vegaeditor"){vegaeditor=window.open("https://vega.github.io/editor/#/","VEGA","");setTimeout(function(){vegaeditor.postMessage({mode:"vega",spec:q,config:{axisY:{minExtent:30}},renderer:"svg"},"https://vega.github.io")},1000)}if(t=="png"){if(r&&r.background){this.graph.background=r.background;this.graph.clear().drawAxes().resetDataStyles().drawData(false)}v.type="image/png";v.file=(r.file||"timeseries.png");this.graph.canvas.c.toBlob(u,v.type);if(r){this.graph.background="";this.graph.clear().drawAxes().resetDataStyles().drawData(false)}}return this};b.prototype.error=function(s,q,r){this.log("ERROR",s,r);if(S(this.el).find(".loader").length==0){S(this.el).html('<div class="loader"><div class="spinner"></div></div>').css({position:"relative",width:"100%",height:"200px"})}if(S(this.el).find(".spinner").length>0){S(this.el).find(".loader").html("&#9888; "+s);this.remove()}S(this.el).find(".loader").append("<br />"+q+"");return this};b.prototype.remove=function(){S(this.el).find(".menuholder").remove();S(this.el).find(".canvasholder").remove();return{}};function m(r,s){var q={menu:'<path style="fill:%COLOUR%;fill-opacity: 0.8;" d="M 5,6 l 22,0 0,4 -22,0 0,-4 M 5,14 l 22,0 0,4 -22,0 0,-4 M 5,22 l 22,0 0,4 -22,0 0,-4 " />',fit:'<path style="fill:%COLOUR%" d="M 0,12 L0,0 12,0 12,4 6,4 12,10 10,12 4,6 4,12 M20,0 L 32,0 32,12 28,12 28,6 22,12 20,10 26,4 20,4 20,0 M 20,32 L20,28 26,28 20,22 22,20 28,26 28,20 32,20, 32,32 20,32 M 12,32 L 0,32 0,20 4,20 4,26 10,20 12,22 6,28 12,28 12,32" />',layers:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,6 l 12,6.5 -12,6.5 -12,-6.5Z" /><path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,10.5 l 12,6.5 -12,6.5 -12,-6.5 Z" /><path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 16,15 l 12,6.5 -12,6.5 -12,-6.5 Z" />',views:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 5,5 l 10,0 0,10 -10,0 0,-2 4,0 0,-2.5 2,0 0,2.5 1,0 0,-5 -1,-1 -2,0 -1,1 3,0 0,1.5 -2,0 0,-1.5 -1,0 0,5 -3,0Z M 17,5 l 10,0 0,10 -10,0 0,-2 6,0 1,-1 0,-1 -1,-1 1,-1 0,-1 -1,-1 -2,0 0,1 2,0 0,1 -0.5,0.5 -1.5,0 0,1 1.5,0 0.5,0.5 0,1 -2,0 0,-5 -1,0 0,6 -3,0Z M 5,17 l 10,0 0,10 -10,0 0,-2 4,0 3,0 0,-1 -3,0 0,-4 3,0 0,-1 -3,0 -1,1 0,4 1,1 -4,0Z M 17,17 l 10,0 0,10 -10,0 0,-2 6,0 1,-1 0,-4 -1,-1 -3,0 0,1 3,0 0,4 -2,0 0,-4 -1,0 0,5 -3,0Z" />',config:'<path style="fill:%COLOUR%;fill-opacity:0.8;" d="M 13.971 4.5996 L 13.377 7.6992 L 13.453 7.6992 A 8.661 8.661 0 0 0 12.008 8.291 L 9.4785 6.5 L 6.5781 9.4004 L 8.3926 11.865 A 8.661 8.661 0 0 0 7.707 13.551 L 7.707 13.4 L 4.6074 13.9 L 4.6074 18 L 7.707 18.5 L 7.707 18.361 A 8.661 8.661 0 0 0 8.3945 20.033 L 6.5781 22.5 L 9.4785 25.4 L 12.01 23.609 A 8.661 8.661 0 0 0 13.395 24.189 L 13.971 27.199 L 18.033 27.199 L 18.547 24.215 A 8.661 8.661 0 0 0 20.014 23.621 L 22.529 25.4 L 25.43 22.5 L 23.635 20.059 A 8.661 8.661 0 0 0 24.289 18.496 L 27.369 18 L 27.369 13.9 L 24.283 13.402 A 8.661 8.661 0 0 0 23.631 11.848 L 25.43 9.4004 L 22.529 6.5 L 20.01 8.2832 A 8.661 8.661 0 0 0 18.564 7.6836 L 18.033 4.5996 L 13.971 4.5996 z M 15.988 10.828 A 5.0719 5.0719 0 0 1 21.061 15.9 A 5.0719 5.0719 0 0 1 15.988 20.973 A 5.0719 5.0719 0 0 1 10.916 15.9 A 5.0719 5.0719 0 0 1 15.988 10.828 z" />',save:'<path style="fill:%COLOUR%;fill-opacity: 0.8;" d="M 6,26 l 20,0 0,-6 -6,0 -4,3 -4,-3 -6,0 Z M 16,20 l 8,-8 -5,0 0,-6 -6,0 0,6 -5,0" />'};return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">'+(q[r]||"").replace(/%COLOUR%/g,(s||"black"))+"</svg>"}function a(s,q){q=(q||",");var w=new RegExp(("(\\"+q+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+q+"\\r\\n]*))"),"gi");var v=[[]];var u=false;while(u=w.exec(s)){var t=u[1];if(t.length&&t!==q){v.push([])}var r;if(u[2]){r=u[2].replace(new RegExp('""',"g"),'"')}else{r=u[3]}v[v.length-1].push(r)}return v}function o(u,w){if(typeof u==="string"){u=a(u)}var r,q,x,s,t;var v=[];q=new Array(u[0].length);x=new Array(u[0].length);for(s=0;s<u[0].length;s++){x[s]=u[0][s];q[s]=w[x[s]]||"string"}for(t=1;t<u.length;t++){if(!u[t]||u[t]==""){continue}r={};for(s=0;s<u[t].length;s++){if(q[s]=="number"){r[x[s]]=parseFloat(u[t][s])}else{r[x[s]]=u[t][s]}}v.push(r)}return v}function h(q,r){if(!r){r=2}q=q+"";while(q.length<r){q="0"+q}return q}function c(r){var q="function zeroPad(d,n){ if(!n){ n = 2;} d = d+''; while(d.length < n){ d = '0'+d; } return d; };";q+="function timeFormat(t,f){ var d = new Date(t); var micros = ''; var m = (t+'').match(/\\.([0-9]+)/);if(m && m.length==2){ micros = m[1]; } var ds = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var dl = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];var ms = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var ml = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return f.replace(/%a/g,ds[d.getDay()]).replace(/%Y/g,d.getFullYear()).replace(/%a/g,dl[d.getDay()]).replace(/%b/g,ms[d.getMonth()]).replace(/%B/g,ml[d.getMonth()]).replace(/%d/g,(d.getDate().length==1 ? '0':'')+d.getDate()).replace(/%m/,(d.getMonth()+1)).replace(/%H/,zeroPad(d.getUTCHours())).replace(/%M/,zeroPad(d.getUTCMinutes())).replace(/%S/,zeroPad(d.getUTCSeconds())).replace(/%L/,zeroPad(d.getUTCMilliseconds(),3)+micros);};";q+="function datetime(y,m,d,h,mn,sc,ms){ return (new Date(y+'-'+zeroPad(m+1,2)+'-'+(typeof d==='number' ? zeroPad(d,2):'01')+(typeof h==='number' ? 'T'+(zeroPad(h,2)+':'+(typeof mn==='number' ? zeroPad(mn,2)+(typeof sc==='number' ? ':'+zeroPad(sc,2)+(ms ? '.'+zeroPad(ms,3):''):''):'00'))+'Z':''))).valueOf(); }";q+="function date(d){ return (new Date(d)).getTime(); }";return Function('"use strict";'+q+" return ("+r+")")()}function i(s){var r=JSON.stringify(s);var q=JSON.parse(r);return q}n.AASTimeSeriesEmbed=function(s,r,q){var t=TimeSeries.create(r,q);t.initialize(S(s)[0]);return};function p(r,q){if(!q){q="jd"}var s=new e(r,"unix");if(q=="jd"){return s.valueOf()}else{if(q=="mjd"){return s.toMJD()}else{if(q=="tjd"){return s.toTJD()}else{if(q=="iso"){return s.toISOString()}else{return s}}}}}function e(r,u,v){epoch=2440587.5;var s=86400;var x=s*1000000;if(typeof r==="number"){if(typeof u!=="undefined"){if(u=="unix"){this.val=q(r)}else{if(u=="epoch"&&v){this.val=q((new Date(v)).getTime()+r*1000)}else{if(u=="mjd"){r+=2400000.5}else{if(u=="tjd"){r+=2440000.5}}}}}if(!this.val){var y=Math.floor(r);this.val=[y,(r-y)*x]}}else{this.val=q(r)}var w=this;this.valueOf=function(){return w.val[0]+w.val[1]/x};this.toUNIX=function(){return((w.val[0]-epoch)*x+w.val[1])/1000};this.toMJD=function(){return(w.val[0]+(w.val[1]/x)-2400000.5)};this.toTJD=function(){return(w.val[0]+(w.val[1]/x)-2440000.5)};this.toISOString=function(){return(new Date(w.toUNIX())).toISOString().replace(/\.0*([^0-9])/,function(t,z){return z})};function q(t){var C=0;var B=0;var z=0;if(typeof t==="undefined"){t=new Date();z=t.getTime()}else{if(typeof t==="string"){var A=0;t=t.replace(/(\:[0-9]{2})\.([0-9]+)/,function(D,F,E){A=parseFloat("0."+E);return F});z=(new Date(t)).getTime();z+=A*1000}else{z=t*1000}}C=Math.floor(z/x);B=(z-C*x)+x/2;return[C+epoch-0.5,B]}return this}n.TimeSeries=TimeSeries})(window||this);