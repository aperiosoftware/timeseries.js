<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<meta http-equiv="X-UA-Compatible" content="chrome=1" />
	<meta name="description" content="AAS Time Series library." />
	<title>AAS Time Series example</title>
	<!-- CSS -->
    <link rel="stylesheet" href="resources/aas.css">
    <link rel="stylesheet" href="resources/style.css">
	<script type="text/javascript" src="resources/highlight/highlight.pack.js"></script>
	<script language="javascript" type="text/javascript" src="resources/stuquery.js"></script>
	<script language="javascript" type="text/javascript" src="resources/timeseries.js"></script>
	<link rel="stylesheet" href="resources/highlight/highlight.css">
</head>
<body>

	<!-- HEADER -->
	<header>
		<div class="row">
			<div class="padded">
				<a id="forkme_banner" href="https://github.com/astrofrog/aas-time-series-js">Fork Me on GitHub</a>
				<h1 id="project_title">Timeseries</h1>
				<h2 id="project_tagline">An HTML5 timeseries library</h2>
				<p>Last updated: 4 September 2018</p>
			</div>
		</div>
	</header>

	<!-- MAIN CONTENT -->
	<div class="row">
		<div class="large-4 medium-4 columns">
			<div class="panel callout">
				<ul>
					<li><a href="#setup">Setting up</a></li>
					<li><a href="#examples">Examples</a></li>
				</ul>
			</div>
		</div>
		<div class="large-8 medium-8 columns">
			<p>This is a short introduction.</p>
		</div>
	</div>
	<div class="row">
		<section id="setup">
			<h2>Setting up</h2>
			<p>To set up we need to include the necessary Javascript files in the top of the page.</p>
			<div class="example">
				<!-- Javascript -->
<!-- StuQuery for DOM manipulation -->
<script language="javascript" type="text/javascript" src="resources/stuquery.js"></script>
<!-- TimeSeries (will lazy-load graph.js when it needs it) -->
<script language="javascript" type="text/javascript" src="resources/timeseries.js"></script>
			</div>
		</section>
	</div>
	<div class="bkg-tint">
		<div class="row">
			<section id="examples">
				<h2>Examples</h2>
				<ol>
					<li>
						<h3>Example 1</h3>
						<p>First we embed a screenshot as an <code>img</code> so that a static version exists if interactivity fails. Next we create a <code>TimeSeries</code> Javascript object with some <code>Vega JSON</code> and then initialise it with the container of the <code>img</code> element. The <code>TimeSeries</code> then replaces the contents of the container with an interactive version.</p>
						<div class="example">
							<figure>
								<div id="example1" style="width:100%;">
									<img src="data/OB110462-simple-big.png" style="width:100%;" />
								</div>
								<figcaption>This plot represents observations of a gravitational <a href="http://lcogt.net/book-page/gravitational-microlensing">microlensing</a> event. Orange points show data from the Danish 1.54m telescope. The dashed line shows a model of the event. The timeseries is created from inline JSON.</figcaption>
							</figure>
							<!-- Javascript -->
							<script>
							var json = {
								"$schema": "https://vega.github.io/schema/vega/v4.json",
								"width": 800,
								"height": 450,
								"padding": 0,
								"autosize": {"type": "fit", "resize": true},
								"data": [{
									"name": "Danish 1.54m",
									"url": "data/OB110462-danish.csv",
									"format": {"type": "csv", "parse": {"HJD":"number", "dmag":"number", "err":"number"}}
								},{
									"name": "Model",
									"url": "data/OB110462-model.csv",
									"format": {"type": "csv", "parse": {"HJD":"number", "dmag":"number", "err":"number"}}
								}],
								"marks":[{
									"type": "line",
									"from": {"data": "Model"},
									"encode": {
										"enter": {
											"x": {"scale": "xscale", "field": "HJD"},
											"y": {"scale": "yscale", "field": "dmag"},
											"strokeWidth": {"value": 2},
											"strokeDash": {"value":[8,8]},
											"tooltip": {"field": "tooltip"}
										},
										"update": {
											"stroke": {"value": "#999999"},
											"fillOpacity": {"value": 1},
											"zindex": {"value": 0}
										}
									}
								},{
									"type": "rect",
									"from": {"data": "Danish 1.54m"},
									"encode": {
										"enter": {
											"x": {"scale": "xscale", "field": "HJD"},
											"y": {"scale": "yscale", "field": "datum['dmag'] - datum['err']"},
											"y2": {"scale": "yscale", "field": "datum['dmag'] + datum['err']"},
											"width": {"value": 1},
											"fill": {"value": "#000000"}
										},
										"update": {
											"fillOpacity": {"value": 1},
											"fill": {"value": "#000000"},
											"zindex": {"value": 0}
										},
										"hover": {
											"fill": {"value": "#FF7F00"},
											"fillOpacity": {"value": 1},
											"zindex": {"value": 1}
										}
									}
								},{
									"type": "symbol",
									"from": {"data": "Danish 1.54m"},
									"encode": {
										"enter": {
											"x": {"scale": "xscale", "field": "HJD"},
											"y": {"scale": "yscale", "field": "dmag"},
											"shape": {"value": "circle"},
											"tooltip": {"field": "tooltip"}
										},
										"update": {
											"shape": "cross",
											"fill": {"value": "#FF7F00"},
											"fillOpacity": {"value": 1},
											"shape": {"value": "circle"},
											"size": {"value": 4},
											"zindex": {"value": 0}
										},
										"hover": {
											"fill": {"value": "#D60303"},
											"fillOpacity": {"value": 1},
											"shape": {"value": "cross"},
											"size": {"value": 10},
											"zindex": {"value": 1}
										}
									}
								}]
							};

							S(document).ready(function(){

								var ex1 = new TimeSeries(json,{'logging':true,'showaswego':false,'fit':true});
								ex1.initialize(document.getElementById('example1'));

							});
							</script>
						</div>
					</li>
					<li>
						<h3>Example 2</h3>
						<p>This example behaves in a similar way to the one above except that we load the <code>Vega JSON</code> from a separate <code>JSON</code> file. The <code>vega-scale</code> attribute tells <code>TimeSeries</code> to use the existing size of the element in the HTML; over-riding the size specified in the <code>JSON</code> file.</p>
						<div class="example">
							<figure style="text-align:center;">
								<div id="example2" vega-src="data/OB110462-simple.json" vega-scale="inherit">
									<img src="data/OB110462-simple.png" style="width:500px;height:250px;" />
								</div>
								<figcaption>An example using JSON loaded from a file specified by the attribute <code>vega-src</code></figcaption>
							</figure>
							<script>
							S(document).ready(function(){
								// Create a new TimeSeries object
								var ex2 = new TimeSeries({},{'logging':true,'showaswego':false});
								ex2.initialize(document.getElementById('example2'));
							});
							</script>
						</div>
					</li>
					<li>
						<h3>Example 3</h3>
						<p>This example shows the same timeseries as the previous example but it is non-interactive by default. We add a CSS class to it and a Javascript event so that the end-user can choose to initialize it. This can help reduce the amount of processing done on page load if there are multiple timeseries on the page.</p>
						<div class="example">
							<figure style="text-align:center;">
								<div id="example3" vega-src="data/OB110462-simple.json" vega-scale="inherit">
									<img src="data/OB110462-simple.png" style="width:500px;height:250px;" />
								</div>
								<figcaption>An example using JSON loaded from a file specified by the attribute <code>vega-src</code></figcaption>
							</figure>
							<style>
							.toload { position: relative; line-height: 0em; cursor: pointer; filter: grayscale(1); }
							.toload:after {
								content: "Click to interact";
								padding: 1em;
								background: rgba(0,0,0,0.7);
								line-height:1em;
								color: white;
								top: 50%;
								left: 50%;
								transform: translate3d(-50%,-50%, 0);
								position: absolute;
								text-align: center;
								margin-right: -50%;
							}
							</style>
							<script>
							S(document).ready(function(){
								var ex3 = new TimeSeries({},{'logging':true,'showaswego':false});
								// Add click event to load the interactive graph
								S('#example3').addClass('toload').on("click",{ts:ex3},function(e){
									e.data.ts.initialize(e.currentTarget);
									// Remove the click event and the toload class
									S(e.currentTarget).off("click").removeClass('toload');
								});
							});
							</script>
						</div>
					</li>
					<li>
						<h3>Example 4</h3>
						<p>A more complicated example with multiple series all in different <code>CSV</code> files.</p>
						<div class="example">
							<figure style="text-align:center;">
								<div id="example4" vega-src="data/OB110462.json">
									<img src="data/OB110462.png" style="width:800px;height:450px;" />
								</div>
								<figcaption>This plot represents observations of a gravitational <a href="http://lcogt.net/book-page/gravitational-microlensing">microlensing</a> event. Each data series shows the variation in brightness of the target star as measured by different telescopes in the <a href="http://robonet.lcogt.net/">ROBONET</a> collaboration.</figcaption>
							</figure>
							<style>
							.toload { position: relative; line-height: 0em; cursor: pointer; filter: grayscale(1); }
							.toload:after {
								content: "Click to interact";
								padding: 1em;
								background: rgba(0,0,0,0.7);
								line-height:1em;
								color: white;
								top: 50%;
								left: 50%;
								transform: translate3d(-50%,-50%, 0);
								position: absolute;
								text-align: center;
								margin-right: -50%;
							}
							.graph-popup { text-align: left; }
							</style>
							<script>
							S(document).ready(function(){

								var ex4 = new TimeSeries({},{'logging':true,'showaswego':false});

								// Add click event to load the interactive graph
								S('#example4').addClass('toload').on("click",{ts:ex4},function(e){
									e.data.ts.initialize(e.currentTarget);
									// Remove the click event and the toload class
									S(e.currentTarget).off("click").removeClass('toload');
								});
							});
							</script>
						</div>
					</li>
				</ol>

			</section>
		</div>
	</div>

	<!-- FOOTER	-->
	<div class="row">
		<footer>
		&copy; 2018 Aperio Software / AAS
		</footer>
	</div>

	
	<script type="text/javascript">
	S(document).ready(function(){

		// Format examples nicely to show how they were done
		ex = S('.example');
		function tidy(t){ return t.replace(/===NEWLINE===/g,"\n").replace(/\n*$/,"").replace(/^\n*/,""); }
		function sanitise(t){ return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;"); }
		function deindent(t){ var indent = ""; t.replace(/^([\s\t]+)/,function(m,p1,p2){ indent = m; }); return t.replace(new RegExp(indent,'g'),"").replace(/[\s\t]+$/,""); }
		for(var i = 0; i < ex.length; i++){
			html = ex[i].innerHTML;
			css = "";
			js = "";
			temp = html.replace(/\n/g,"===NEWLINE===").replace(/<!-- HTML -->/i,"");
			temp = temp.replace(/<!-- Javascript -->/i,"").replace(/<script>(.*)<\/script>/,function(m,p1){
				js = js+tidy(p1);
				return "";
			})
			temp = temp.replace(/<!-- CSS -->/i,"").replace(/<style>(.*)<\/style>/,function(m,p1){
				css = tidy(p1);
				return "";
			});
		
			code = sanitise(tidy(temp));
			code = code.replace(/(src|href)=\"([^\"]+)\"/g,function(m,p1,p2){ return p1+'="<a href="'+p2+'">'+p2+'</a>"'; });
			
			showtitle = true;
			if(S(ex[i]).attr('data-title')=="false") showtitle = false;
		
			ex[i].innerHTML = ''+html+(showtitle ? '<h3>How to do it</h3><h4>HTML</h4>':'')+'<pre class="prettyprint lang-html">'+deindent(code)+'</pre>'+(css ? (showtitle ? '<h4>CSS</h4>':'')+'<pre class="prettyprint lang-css">'+deindent(sanitise(css))+'</pre>':'')+(js ? (showtitle ? '<h4>Javascript</h4>':'')+'<pre class="prettyprint lang-js">'+deindent(sanitise(js))+'</pre>':'');
		}
	
		var code = S('.prettyprint');
		for(var i = 0; i < code.length; i++) hljs.highlightBlock(code[i]);
	});
	</script>
</body>
</html>
