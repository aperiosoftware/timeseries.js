<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<meta http-equiv="X-UA-Compatible" content="chrome=1" />
	<meta name="description" content="AAS Time Series library." />
	<title>AAS Time Series example</title>
    <link rel="stylesheet" href="resources/aas.css">
    <link rel="stylesheet" href="resources/style.css">
	<link rel="stylesheet" href="resources/highlight/highlight.css">
	<script type="text/javascript" src="resources/highlight/highlight.pack.js"></script>
</head>
<body>

	<!-- HEADER -->
	<header>
		<div class="row">
			<div class="padded">
				<a id="forkme_banner" href="https://github.com/astrofrog/aas-time-series-js">Fork Me on GitHub</a>
				<h1 id="project_title">Timeseries library</h1>
				<p>Last updated: 24 September 2018</p>
			</div>
		</div>
	</header>

	<!-- MAIN CONTENT -->
	<div class="row">
		<div class="large-4 medium-4 columns">
			<div class="panel callout">
				<ul>
					<li><a href="#setup">Setting up</a></li>
					<li><a href="#ex1">Example 1</a></li>
					<li><a href="#ex2">Example 2</a></li>
					<li><a href="#ex3">Example 3</a></li>
					<li><a href="#ex4">Example 4</a></li>
					<li><a href="#ex5">Example 5</a></li>
				</ul>
			</div>
		</div>
		<div class="large-8 medium-8 columns">
			<p>This is a short introduction.</p>
		</div>
	</div>
	<div class="row">
		<section id="setup">
			<h2>Setting up</h2>
			<p>To set up we need to include the necessary Javascript files in the top of the page.</p>
			<div class="example">
				<!-- Javascript -->
<!-- StuQuery for DOM manipulation -->
<script language="javascript" type="text/javascript" src="resources/stuquery.js"></script>
<!-- TimeSeries (will lazy-load graph.js when it needs it) -->
<script language="javascript" type="text/javascript" src="resources/timeseries.js"></script>
			</div>
		</section>
	</div>
	<div class="bkg-tint">
		<div class="row">
			<section id="examples">
				<h2>Examples</h2>
				<ol>
					<li id="ex1">
						<h3>Example 1</h3>
						<p>First we embed a screenshot as an <code>img</code> so that a static version exists if interactivity fails. Next we create a <code>TimeSeries</code> Javascript object with some <code>Vega JSON</code> and then initialise it with the container of the <code>img</code> element. The <code>TimeSeries</code> then replaces the contents of the container with an interactive version.</p>
						<div class="example">
							<figure>
								<div id="example1">
									<img src="data/OB110462-simple-big.png" />
								</div>
								<figcaption>This plot represents observations of a gravitational <a href="http://lcogt.net/book-page/gravitational-microlensing">microlensing</a> event. Orange points show data from the Danish 1.54m telescope. The dashed line shows a model of the event. The timeseries is created from inline JSON.</figcaption>
							</figure>
							<!-- Javascript -->
							<script>
							S(document).ready(function(){

								var json = {
									"$schema": "https://vega.github.io/schema/vega/v4.json",
									"width": 800,
									"height": 450,
									"padding": 0,
									"autosize": {"type": "fit", "resize": true},
									"data": [{
										"name": "Danish 1.54m",
										"url": "data/OB110462-danish.csv",
										"format": {"type": "csv", "parse": {"HJD":"number", "dmag":"number", "err":"number"}}
									},{
										"name": "Model",
										"url": "data/OB110462-model.csv",
										"format": {"type": "csv", "parse": {"HJD":"number", "dmag":"number", "err":"number"}}
									}],
									"axes": [
										{
											"orient": "bottom",
											"scale": "xscale",
											"title": "Observation time"
										},{
											"orient": "left",
											"scale": "yscale",
											"title": "Intensity"
										}
									],
									"marks":[{
										"type": "line",
										"from": {"data": "Model"},
										"encode": {
											"enter": {
												"x": {"scale": "xscale", "field": "HJD"},
												"y": {"scale": "yscale", "field": "dmag"},
												"strokeWidth": {"value": 2},
												"strokeDash": {"value":[8,8]},
												"tooltip": {"field": "tooltip"}
											},
											"update": {
												"stroke": {"value": "#999999"},
												"fillOpacity": {"value": 1},
												"zindex": {"value": 0}
											}
										}
									},{
										"type": "rect",
										"from": {"data": "Danish 1.54m"},
										"encode": {
											"enter": {
											"x": {"scale": "xscale", "field": "x"},
												"x": {"scale": "xscale", "field": "HJD"},
												"y": {"scale": "yscale", "signal": "datum.dmag - datum.err"},
												"y2": {"scale": "yscale", "signal": "datum.dmag + datum.err"},
												"width": {"value": 1},
												"fill": {"value": "#FF7F00"},
												"fillOpacity": {"value": 0.5}
											},
											"update": {
												"fillOpacity": {"value": 1},
												"fill": {"value": "#FF7F00"}
											},
											"hover": {
												"fill": {"value": "#D60303"}
											}
										}
									},{
										"type": "symbol",
										"from": {"data": "Danish 1.54m"},
										"encode": {
											"enter": {
												"x": {"scale": "xscale", "field": "HJD"},
												"y": {"scale": "yscale", "field": "dmag"},
												"shape": {"value": "circle"},
												"tooltip": {"signal": "'Time: ' + datum.x + '<br />Dmag: ' + datum.dmag + '<br />Error: ' + datum.err"}
											},
											"update": {
												"shape": "cross",
												"fill": {"value": "#FF7F00"},
												"fillOpacity": {"value": 1},
												"shape": {"value": "circle"},
												"size": {"value": 16},
												"zindex": {"value": 0}
											},
											"hover": {
												"fill": {"value": "#D60303"},
												"fillOpacity": {"value": 1},
												"shape": {"value": "cross"},
												"size": {"value": 100},
												"zindex": {"value": 1}
											}
										}
									}]
								};

								var ex1 = TimeSeries.create(json);
								ex1.initialize(document.getElementById('example1'));

							});
							</script>
						</div>
					</li>
					<li id="ex2">
						<h3>Example 2</h3>
						<p>This example behaves in a similar way to the one above except that we load the <code>Vega JSON</code> from a separate file. The <code>fit:true</code> attribute tells <code>TimeSeries</code> to use the existing size of the element in the HTML; over-riding the size specified in the <code>JSON</code> file.</p>
						<div class="example">
							<figure>
								<div id="example2">
									<img src="data/OB110462-simple2.png" style="width:500px;height:250px;" />
								</div>
								<figcaption>An example using JSON loaded from a file</figcaption>
							</figure>
							<script>
							S(document).ready(function(){
								// Create a new TimeSeries object
								var ex2 = TimeSeries.create("data/OB110462-simple.json",{fit:true});
								ex2.initialize(document.getElementById('example2'));
							});
							</script>
						</div>
					</li>
					<li id="ex3">
						<h3>Example 3</h3>
						<p>This example is identical to the one above except that the container has a size specified in CSS and we inherit that using the <code>fit:true</code> option rather than use the width and height set in the <code>JSON</code>.</p>
						<div class="example">
							<figure>
								<div id="example3" style="width:100%;height:300px">
									<img src="data/OB110462-simple2.png" />
								</div>
								<figcaption>An example using JSON loaded from a file</figcaption>
							</figure>
							<script>
							S(document).ready(function(){
								// Create a new TimeSeries object
								var ex3 = TimeSeries.create("data/OB110462-simple.json",{'fit':true});
								ex3.initialize(document.getElementById('example3'));
							});
							</script>
						</div>
					</li>
					<li id="ex4">
						<h3>Example 4</h3>
						<p>This example shows the same timeseries as the previous example but it is non-interactive by default. We add a CSS class to it and a Javascript event so that the end-user can choose to initialize it. This can help reduce the amount of processing done on page load if there are multiple timeseries on the page.</p>
						<div class="example">
							<figure>
								<div id="example4" class="toload">
									<img src="data/OB110462-simple.png" style="width:500px;height:250px;" />
								</div>
								<figcaption>An example using JSON loaded from a file</figcaption>
							</figure>
							<style>
							.toload { position: relative; line-height: 0em; cursor: pointer; filter: grayscale(1); }
							.toload:after {
								content: "Click to interact";
								padding: 1em;
								background: rgba(0,0,0,0.7);
								line-height:1em;
								color: white;
								top: 50%;
								left: 50%;
								transform: translate3d(-50%,-50%, 0);
								position: absolute;
								text-align: center;
								margin-right: -50%;
							}
							</style>
							<script>
								var ex4 = TimeSeries.create("data/OB110462-simple.json",{'logging':true});
								// Add click event to load the interactive graph
								S('#example4').on("click",{ts:ex4},function(e){
									// Initialise the TimeSeries
									e.data.ts.initialize(e.currentTarget);
									// Remove the click event and the toload class
									S(e.currentTarget).off("click").removeClass('toload');
								});
							</script>
						</div>
					</li>
					<li id="ex5">
						<h3>Example 5</h3>
						<p>A more complicated example with multiple series all in different <code>CSV</code> files.</p>
						<div class="example">
							<figure>
								<div id="example5" class="toload">
									<img src="data/OB110462.png" style="width:800px;height:450px;" />
								</div>
								<figcaption>This plot represents observations of a gravitational <a href="http://lcogt.net/book-page/gravitational-microlensing">microlensing</a> event. Each data series shows the variation in brightness of the target star as measured by different telescopes in the <a href="http://robonet.lcogt.net/">ROBONET</a> collaboration.</figcaption>
							</figure>
							<style>
							.toload { position: relative; line-height: 0em; cursor: pointer; filter: grayscale(1); }
							.toload:after {
								content: "Click to interact";
								padding: 1em;
								background: rgba(0,0,0,0.7);
								line-height:1em;
								color: white;
								top: 50%;
								left: 50%;
								transform: translate3d(-50%,-50%, 0);
								position: absolute;
								text-align: center;
								margin-right: -50%;
							}
							.graph-popup { text-align: left; }
							</style>
							<script>
							S(document).ready(function(){

								var ex5 = TimeSeries.create("data/OB110462.json",{'logging':true,'fit':true});
								// Add click event to load the interactive graph
								S('#example5').on("click",{ts:ex5},function(e){
									e.data.ts.initialize(e.currentTarget);
									// Remove the click event and the toload class
									S(e.currentTarget).off("click").removeClass('toload');
								});
							});
							</script>
						</div>
					</li>
					<li id="ex6">
						<h3>Example 6</h3>
						<p>This example uses a different dataset. Once again we delay loading so start with a static image. This time we use the <code>mouseover</code> event to prompt interaction. In this example we style the tooltips using a CSS class (<code>aas-theme</code>) provided in the Javascript set-up.</p>
						<div class="example">
							<figure>
								<div id="example6">
									<img src="data/lightcurve.png" style="width:500px;height:350px;" />
								</div>
								<figcaption>An example using JSON loaded from a file</figcaption>
							</figure>
							<style>
							.toload { position: relative; line-height: 0em; cursor: pointer; filter: grayscale(1); }
							.toload:after {
								content: "Click to interact";
								padding: 1em;
								background: rgba(0,0,0,0.7);
								line-height:1em;
								color: white;
								top: 50%;
								left: 50%;
								transform: translate3d(-50%,-50%, 0);
								position: absolute;
								text-align: center;
								margin-right: -50%;
							}
							.my-theme {
								background: #253788!important;
								color: white!important;
								padding: 0.5em 1em;
								text-align: left;
								box-shadow: 1px 1px 5px rgba(0,0,0,0.2);
							}
							</style>
							<script>
								var ex6 = TimeSeries.create("data/lightcurve.json",{'logging':true,'fit':true,'tooltip':{'theme':'my-theme'}});
								// Add mouseover event to load the interactive graph
								S('#example6').on("mouseover",{ts:ex6},function(e){
									// Initialise the TimeSeries
									e.data.ts.initialize(e.currentTarget);
									// Remove the click event and the toload class
									S(e.currentTarget).off("mouseover");
								});
							</script>
						</div>
					</li>
				</ol>

			</section>
		</div>
	</div>

	<!-- FOOTER	-->
	<div class="row">
		<footer>
		&copy; 2018 Aperio Software / AAS
		</footer>
	</div>

	<script language="javascript" type="text/javascript" src="resources/formatexamples.js"></script>

</body>
</html>
